"use strict";(()=>{var e={};e.id=7607,e.ids=[7607],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},99112:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>M});var a={};r.r(a),r.d(a,{GET:()=>l});var n=r(95815),i=r(51150),o=r(10007),s=r(30596),u=r(71763);async function d(e){let{searchParams:t}=new URL(e.url),r=t.get("dealerId")||"toyota-naples",a=t.get("timeframe")||"30d";try{let e={chatgpt:74+Math.round(21*Math.random()),claude:69+Math.round(26*Math.random()),perplexity:64+Math.round(31*Math.random()),gemini:59+Math.round(36*Math.random())},t=(0,u.o)(e),n=(t=>{let r=[],a=new Date;for(let n=t-1;n>=0;n--){let t=new Date(a);t.setDate(t.getDate()-n);let i=(Math.random()-.5)*10,o={chatgpt:Math.max(0,Math.min(100,e.chatgpt+i)),claude:Math.max(0,Math.min(100,e.claude+i)),perplexity:Math.max(0,Math.min(100,e.perplexity+i)),gemini:Math.max(0,Math.min(100,e.gemini+i))};r.push({date:t.toISOString().split("T")[0],visibility:(0,u.o)(o),platforms:o})}return r})((e=>{switch(e){case"7d":return 7;case"30d":default:return 30;case"90d":return 90}})(a)),i=n[0]?.visibility||t-5,o={dealerId:r,timeframe:a,timestamp:new Date().toISOString(),current:{overall:t,platforms:e,change:t-i,changePercent:Math.round((t-i)/i*100)},historical:n,breakdown:{brandMentions:Math.round(.9*t+10*Math.random()),productReferences:Math.round(.85*t+15*Math.random()),locationContext:Math.round(.95*t+5*Math.random()),serviceOfferings:Math.round(.8*t+20*Math.random())},platformInsights:{chatgpt:{score:e.chatgpt,strength:"Product recommendations",weakness:"Local context",trend:Math.random()>.5?"improving":"declining"},claude:{score:e.claude,strength:"Technical explanations",weakness:"Brand recognition",trend:Math.random()>.5?"improving":"stable"},perplexity:{score:e.perplexity,strength:"Real-time information",weakness:"Service details",trend:Math.random()>.5?"stable":"improving"},gemini:{score:e.gemini,strength:"Visual recognition",weakness:"Complex queries",trend:Math.random()>.5?"improving":"declining"}},competitive:{industryAverage:Math.round(.85*t),regionalAverage:Math.round(.92*t),topCompetitor:Math.round(1.15*t),ranking:Math.ceil(8*Math.random())+2},trends:{momentum:t>i?"positive":"negative",volatility:Math.round(20*Math.random()+5),predictedNext30Days:Math.round(t+(Math.random()-.5)*10),confidenceLevel:Math.round(85+12*Math.random())}};return s.Z.json(o)}catch(e){return console.error("Visibility API error:",e),s.Z.json({error:"Failed to fetch visibility data"},{status:500})}}let l=(0,r(72225).c2)(d),c=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/visibility/route",pathname:"/api/visibility",filename:"route",bundlePath:"app/api/visibility/route"},resolvedPagePath:"/Users/briankramer/Documents/GitHub/dealership-ai/apps/web/app/api/visibility/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:m,headerHooks:g,staticGenerationBailout:M}=c,f="/api/visibility/route";function v(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},72225:(e,t,r)=>{r.d(t,{c2:()=>o,do:()=>u,vG:()=>d,xq:()=>s});var a=r(30596),n=r(44955);function i(e,t={}){return async r=>{let{roles:i=[],requireDealerId:o=!1,bypassInDevelopment:s=!0}=t;try{let t=await (0,n.getToken)({req:r,secret:process.env.NEXTAUTH_SECRET});if(!t)return a.Z.json({error:"Authentication required"},{status:401});let s={id:t.sub,email:t.email,name:t.name,role:t.role,dealerId:t.dealerId};if(i.length>0&&!i.includes(s.role))return a.Z.json({error:"Insufficient permissions",required:i,current:s.role},{status:403});if(o&&!s.dealerId)return a.Z.json({error:"Dealer association required"},{status:403});return r.user=s,e(r)}catch(e){return console.error("Auth middleware error:",e),a.Z.json({error:"Authentication verification failed"},{status:500})}}}function o(e){return i(e,{roles:["admin"]})}function s(e){return i(e,{roles:["admin","dealer"],requireDealerId:!0})}function u(e,t,r){return"admin"===r||("dealer"===r||"user"===r)&&t===e}function d(e){let{searchParams:t,pathname:r}=new URL(e.url),a=t.get("dealerId");if(a)return a;let n=r.split("/"),i=n.indexOf("dealer");if(-1!==i&&n[i+1])return n[i+1]}},71763:(e,t,r)=>{function a(e){let t={chatgpt:.35,claude:.3,perplexity:.2,gemini:.15};return Math.round(e.chatgpt*t.chatgpt+e.claude*t.claude+e.perplexity*t.perplexity+e.gemini*t.gemini)}function n(e,t){return t?Math.round(e/t*100):0}r.d(t,{m:()=>n,o:()=>a})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1262,722,4955],()=>r(99112));module.exports=a})();