"use strict";(()=>{var e={};e.id=6021,e.ids=[6021],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},38357:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>b,originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>q,staticGenerationBailout:()=>v});var a={};t.r(a),t.d(a,{GET:()=>m});var o=t(95815),i=t(51150),s=t(10007),n=t(30596),u=t(2381),l=t(11123),d=t(17856),p=t(72225);let c={get:async e=>await d.F.get(e),async set(e,r){await d.F.set(e,String(r),86400)}};async function g(e){try{let e=await ({async getJobCounts(){let e=await l.c.getMetrics();return{waiting:e.pending,active:e.processing,completed:e.completed,failed:e.failed}}}).getJobCounts(),r=new Date().toISOString().slice(0,10),t=new Date().toISOString().slice(0,7),a=await c.get(`probe:cost:daily:${r}`)||"0",o=await c.get(`probe:cost:monthly:${t}`)||"0",i=await ({getJobs:async(e,r,t,a)=>(await l.c.getJobsByStatus("failed")).slice(r,t+1).map(e=>({id:e.id,timestamp:e.createdAt.getTime(),data:e.payload}))}).getJobs(["waiting","delayed"],0,499,!0),s=i.map(e=>Math.max(0,Math.floor((Date.now()-e.timestamp)/6e4))).sort((e,r)=>e-r),u=s.length?s[Math.floor(.95*s.length)-1]||s[s.length-1]:0,d=s.length?s[s.length-1]:0;return n.Z.json({counts:e,cost:{daily:Number(a),monthly:Number(o)},dlq:{count:i.length,age_p95_min:u,oldest_min:d}})}catch(e){return u.kg.error("Probe status API error",e instanceof Error?e:Error(String(e))),n.Z.json({error:"Internal server error"},{status:500})}}let m=(0,p.c2)(g),h=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/v1/probe/status/route",pathname:"/api/v1/probe/status",filename:"route",bundlePath:"app/api/v1/probe/status/route"},resolvedPagePath:"/Users/briankramer/Documents/GitHub/dealership-ai/apps/web/app/api/v1/probe/status/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:q,serverHooks:x,headerHooks:b,staticGenerationBailout:v}=h,w="/api/v1/probe/status/route";function y(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:q})}},72225:(e,r,t)=>{t.d(r,{c2:()=>s,do:()=>u,vG:()=>l,xq:()=>n});var a=t(30596),o=t(44955);function i(e,r={}){return async t=>{let{roles:i=[],requireDealerId:s=!1,bypassInDevelopment:n=!0}=r;try{let r=await (0,o.getToken)({req:t,secret:process.env.NEXTAUTH_SECRET});if(!r)return a.Z.json({error:"Authentication required"},{status:401});let n={id:r.sub,email:r.email,name:r.name,role:r.role,dealerId:r.dealerId};if(i.length>0&&!i.includes(n.role))return a.Z.json({error:"Insufficient permissions",required:i,current:n.role},{status:403});if(s&&!n.dealerId)return a.Z.json({error:"Dealer association required"},{status:403});return t.user=n,e(t)}catch(e){return console.error("Auth middleware error:",e),a.Z.json({error:"Authentication verification failed"},{status:500})}}}function s(e){return i(e,{roles:["admin"]})}function n(e){return i(e,{roles:["admin","dealer"],requireDealerId:!0})}function u(e,r,t){return"admin"===t||("dealer"===t||"user"===t)&&r===e}function l(e){let{searchParams:r,pathname:t}=new URL(e.url),a=r.get("dealerId");if(a)return a;let o=t.split("/"),i=o.indexOf("dealer");if(-1!==i&&o[i+1])return o[i+1]}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[1262,722,4955,1123],()=>t(38357));module.exports=a})();