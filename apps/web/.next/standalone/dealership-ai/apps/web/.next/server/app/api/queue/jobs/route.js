"use strict";(()=>{var a={};a.id=8230,a.ids=[8230],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:a=>{a.exports=require("assert")},14985:a=>{a.exports=require("dns")},19121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:a=>{a.exports=require("os")},27910:a=>{a.exports=require("stream")},28354:a=>{a.exports=require("util")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:a=>{a.exports=require("tls")},41204:a=>{a.exports=require("string_decoder")},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{a.exports=require("crypto")},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73560:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>J,patchFetch:()=>I,routeModule:()=>E,serverHooks:()=>H,workAsyncStorage:()=>F,workUnitAsyncStorage:()=>G});var d={};c.r(d),c.d(d,{GET:()=>C,POST:()=>D});var e=c(30480),f=c(24037),g=c(45492),h=c(39414),i=c(56540),j=c(261),k=c(89594),l=c(46344),m=c(81288),n=c(18123),o=c(96357),p=c(24807),q=c(51689),r=c(46494),s=c(86439),t=c(2548),u=c(35497),v=c(88357),w=c(9757),x=c(27757),y=c(82898),z=c(84237);async function A(a){let b=Date.now();v.vF.info("Processing batch test job",{jobId:a.id,templateId:a.payload.templateId,variationCount:a.payload.variations.length});let{templateId:c,variations:d,settings:e={}}=a.payload,f=y.G.getTemplate(c);if(!f)throw Error(`Template not found: ${c}`);let g={...f.settings,...e,model:e.model||f.settings?.model||"gpt-4o-mini"},h=[],i=0,j=0;for(let b=0;b<d.length;b++)try{let e=await y.G.expandPrompt(c,d[b]),f=await B(e.expandedPrompt,g),k=e.metadata.tokenCount||0,l=f.outputTokens,m=z.e.calculateCost("openai",g.model,k,l);a.metadata.userId&&await z.e.recordCost({provider:"openai",model:g.model,operation:"completion",inputTokens:k,outputTokens:l,userId:a.metadata.userId,dealerId:a.metadata.dealerId,batchId:a.metadata.batchId});let n={index:b,variables:d[b],expandedPrompt:e.expandedPrompt,response:f.content,metadata:{inputTokens:k,outputTokens:l,cost:m,model:g.model,processingTime:f.processingTime}};h.push(n),i+=k+l,j+=m,await new Promise(a=>setTimeout(a,50+100*Math.random())),((b+1)%10==0||b===d.length-1)&&v.vF.debug("Batch test progress",{jobId:a.id,completed:b+1,total:d.length,percentage:Math.round((b+1)/d.length*100)})}catch(c){v.vF.error("Error processing variation",c instanceof Error?c:Error(String(c)),{jobId:a.id,variationIndex:b,variables:d[b]}),h.push({index:b,variables:d[b],error:c instanceof Error?c.message:String(c)})}i>0&&await y.G.recordTemplateUsage(c,i);let k=Date.now()-b;return v.vF.info("Batch test job completed",{jobId:a.id,templateId:c,successful:h.filter(a=>!a.error).length,failed:h.filter(a=>a.error).length,totalTokens:i,totalCost:j,duration:k}),{results:h,totalTokens:i,totalCost:j,duration:k}}async function B(a,b){let c=200+300*Math.random();await new Promise(a=>setTimeout(a,c));let d=Math.ceil(a.length/4),e=Math.min(b.maxTokens||150,Math.round(30+120*Math.random())),f=["Based on your dealership analysis, here are the key recommendations for improving your online visibility and search rankings.","The automotive market in your area shows significant opportunities for digital optimization and customer engagement.","Your current SEO performance indicates several areas for improvement, particularly in local search optimization.","Customer behavior analysis reveals important trends that can inform your marketing and service strategies.","Competitive analysis shows your position in the market and identifies key areas where you can gain advantage."],g=f[Math.floor(Math.random()*f.length)];return{content:`${g}

Detailed Analysis:
• Search visibility metrics
• Local market positioning
• Customer engagement opportunities
• Technical optimization recommendations

This analysis is based on current market data and industry best practices for automotive dealerships.`,outputTokens:e,processingTime:c,metadata:{model:b.model,temperature:b.temperature||.7,promptTokens:d}}}async function C(a){try{let b=await w.vR.authenticateRequest(a);if(!b||!w.vR.hasPermission(b,"read:queue"))return u.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:c}=new URL(a.url),d=c.get("status"),e=c.get("type"),f=parseInt(c.get("limit")||"50"),g=parseInt(c.get("offset")||"0"),h=(await x.g.listJobs({status:d,type:e||void 0,limit:f,offset:g})).filter(a=>"admin"===b.role||a.metadata.userId===b.id||a.metadata.dealerId===b.dealerId);return u.NextResponse.json({jobs:h,total:h.length,filters:{status:d,type:e,limit:f,offset:g}})}catch(a){return v.vF.error("Queue jobs API error",a instanceof Error?a:Error(String(a))),u.NextResponse.json({error:"Internal server error"},{status:500})}}async function D(a){try{let b=await w.vR.authenticateRequest(a);if(!b||!w.vR.hasPermission(b,"write:queue"))return u.NextResponse.json({error:"Unauthorized"},{status:401});let{type:c,payload:d,priority:e="normal",maxAttempts:f=3}=await a.json();if(!c||!d)return u.NextResponse.json({error:"type and payload are required"},{status:400});let g=await x.g.add(c,d,{priority:e,maxAttempts:f,metadata:{userId:b.id,dealerId:b.dealerId,createdBy:b.email}});return v.vF.info("Job queued via API",{jobId:g,type:c,priority:e,userId:b.id}),u.NextResponse.json({success:!0,jobId:g,message:"Job queued for processing"})}catch(a){return v.vF.error("Queue job creation error",a instanceof Error?a:Error(String(a))),u.NextResponse.json({error:"Failed to queue job",details:a instanceof Error?a.message:String(a)},{status:500})}}x.g.registerProcessor("batch-test",A);let E=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/queue/jobs/route",pathname:"/api/queue/jobs",filename:"route",bundlePath:"app/api/queue/jobs/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/briankramer/dealership-ai/apps/web/app/api/queue/jobs/route.ts",nextConfigOutput:"standalone",userland:d}),{workAsyncStorage:F,workUnitAsyncStorage:G,serverHooks:H}=E;function I(){return(0,g.patchFetch)({workAsyncStorage:F,workUnitAsyncStorage:G})}async function J(a,b,c){var d;let e="/api/queue/jobs/route";"/index"===e&&(e="/");let g=await E.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),F=!!(y.dynamicRoutes[D]||y.routes[C]);if(F&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||E.isDev||x||(G="/index"===(G=C)?"/":G);let H=!0===E.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>E.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>E.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await E.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await E.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||b instanceof s.NoFallbackError||await E.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},79428:a=>{a.exports=require("buffer")},79551:a=>{a.exports=require("url")},79748:a=>{a.exports=require("fs/promises")},83997:a=>{a.exports=require("tty")},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{a.exports=require("net")},94735:a=>{a.exports=require("events")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[6118,810,8909,7732],()=>b(b.s=73560));module.exports=c})();