"use strict";(()=>{var a={};a.id=6825,a.ids=[6825],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:a=>{a.exports=require("bcrypt")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{a.exports=require("querystring")},12412:a=>{a.exports=require("assert")},19121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},28354:a=>{a.exports=require("util")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{a.exports=require("crypto")},55591:a=>{a.exports=require("https")},57265:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>Q,patchFetch:()=>P,routeModule:()=>L,serverHooks:()=>O,workAsyncStorage:()=>M,workUnitAsyncStorage:()=>N});var d={};c.r(d),c.d(d,{GET:()=>F,POST:()=>E});var e=c(30480),f=c(24037),g=c(45492),h=c(39414),i=c(56540),j=c(261),k=c(89594),l=c(46344),m=c(81288),n=c(18123),o=c(96357),p=c(24807),q=c(51689),r=c(46494),s=c(86439),t=c(2548),u=c(35497),v=c(26315),w=c(68382);async function x(a,b,c="3months"){let d=function(a){let b=a.map(a=>a.revenue||0),c=b.reduce((a,b)=>a+b,0)/b.length,d=function(a){if(a.length<2)return 0;let b=a[0];return Math.pow(a[a.length-1]/b,1/(a.length-1))-1}(b);return{average:c,growth:d,seasonality:D(b),volatility:function(a){let b=a.reduce((a,b)=>a+b,0)/a.length;return Math.sqrt(a.reduce((a,c)=>a+Math.pow(c-b,2),0)/a.length)/b}(b),trend:d>0?"increasing":d<0?"decreasing":"stable"}}(b),e=function(a,b){let c=.7*a.predicted_value+.3*b.predicted_value;return{predicted_value:c,current_value:b.current_value,change_percent:(c-b.current_value)/b.current_value*100,trend:c>b.current_value?"increasing":"decreasing",confidence_interval:[.85*c,1.15*c],key_drivers:[...a.key_drivers||[],...b.key_drivers],recommendations:[...a.recommendations||[],...b.recommendations],risk_factors:[...a.risk_factors||[],...b.risk_factors]}}(await B(a,d,c),function(a,b){let c=a.map(a=>a.revenue||0),d=function(a){let b=a.length,c=Array.from({length:b},(a,b)=>b),d=c.reduce((a,b)=>a+b,0),e=a.reduce((a,b)=>a+b,0),f=(b*c.reduce((b,c,d)=>b+c*a[d],0)-d*e)/(b*c.reduce((a,b)=>a+b*b,0)-d*d),g=(e-f*d)/b;return{slope:f,intercept:g}}(c),e=D(c),f=d.slope*("1month"===b?1:"3months"===b?3:"6months"===b?6:12)+d.intercept+e.adjustment;return{predicted_value:Math.max(0,f),current_value:c[c.length-1]||0,change_percent:(f-(c[c.length-1]||0))/(c[c.length-1]||1)*100,trend:d.slope>0?"increasing":d.slope<0?"decreasing":"stable",confidence_interval:[.9*f,1.1*f],key_drivers:["Historical trend","Seasonal patterns","Market conditions"],recommendations:["Monitor trend continuation","Prepare for seasonal variations"],risk_factors:["Economic uncertainty","Market volatility"]}}(b,c));return{dealerId:a,model:{type:"revenue",timeframe:c,confidence:e.confidence,factors:e.factors},result:e,timestamp:new Date().toISOString(),data_points_used:b.length}}async function y(a,b,c){var d,e;let f=b.aiVisibility||50,g=(d=b,(e=c).length?e.reduce((a,b)=>a+(b.aiVisibility||50),0)/e.length-(d.aiVisibility||50):0),h={dealerId:a,currentVisibility:f,competitiveGap:g,marketTrends:await C(a),historicalPerformance:b.trends||[]},i=function(a,b){let c=b*(1+.5*Math.random()-.25);return{predicted_value:Math.max(0,Math.min(100,c)),current_value:b,change_percent:(c-b)/b*100,trend:c>b?"increasing":"decreasing",confidence_interval:[.9*c,1.1*c],key_drivers:["Content optimization","Schema implementation","Local SEO improvements"],recommendations:["Implement structured data","Optimize for voice search","Improve local citations"],risk_factors:["Algorithm changes","Increased competition","Market saturation"]}}((await (0,w.pL)(`Predict AI visibility trends for the next 3 months based on current performance and competitive landscape. Current visibility: ${f}%, competitive gap: ${g}%.`,h,"claude")).content,f);return{dealerId:a,model:{type:"visibility",timeframe:"3months",confidence:i.confidence,factors:["current_seo_score","content_freshness","schema_implementation","local_citations","competitive_gap","search_trends"]},result:i,timestamp:new Date().toISOString(),data_points_used:c.length+(b.trends?.length||0)}}async function z(a,b){let c=function(a){let b=a.reduce((a,b)=>a+(b.purchaseValue||0),0)/a.length,c=a.reduce((a,b)=>a+(b.purchaseFrequency||0),0)/a.length,d=a.reduce((a,b)=>a+(b.lifespanMonths||12),0)/a.length;return{currentCLV:b*c*d,predictedCLV:b*c*d*1.15}}(b);return{dealerId:a,model:{type:"customer_behavior",timeframe:"6months",confidence:.78,factors:["purchase_history","service_interactions","digital_engagement","satisfaction_scores"]},result:{predicted_value:c.predictedCLV,current_value:c.currentCLV,change_percent:(c.predictedCLV-c.currentCLV)/c.currentCLV*100,trend:c.predictedCLV>c.currentCLV?"increasing":"decreasing",confidence_interval:[.85*c.predictedCLV,1.15*c.predictedCLV],key_drivers:["Service satisfaction scores","Purchase frequency patterns","Seasonal buying trends","Loyalty program engagement","Digital touchpoint interactions"],recommendations:["Focus on high-value customer retention programs","Implement personalized marketing campaigns","Optimize service department experience","Enhance digital customer journey"],risk_factors:["Economic downturn impact on luxury purchases","Increased competition from online dealers","Changing consumer preferences toward EVs"]},timestamp:new Date().toISOString(),data_points_used:b.length}}async function A(a,b){var c;let d=function(a,b){let c=b.map(a=>a.overallScore||50),d=c.reduce((a,b)=>a+b,0)/c.length;return{position:d>60?"strong":d>40?"competitive":"challenging",analysis:{strengths:["Local market knowledge","Customer service"],weaknesses:["Digital presence","Online reputation"],opportunities:["Voice search optimization","Mobile experience"],threats:["New market entrants","Digital-first competitors"]}}}(0,b),e={dealerId:a,competitorCount:b.length,marketPosition:d.position,strengthsWeaknesses:d.analysis},f=(c=(await (0,w.pL)(`Analyze competitive threats and opportunities for the next 6 months. Current market position: ${d.position}. Key competitors: ${b.length}.`,e,"claude")).content,{predicted_value:75,current_value:65,change_percent:15.4,trend:"increasing",confidence_interval:[70,80],key_drivers:["Digital transformation","Customer experience enhancement","Market positioning"],recommendations:["Invest in digital marketing","Enhance online presence","Focus on customer retention"],risk_factors:["New market entrants","Economic downturn","Technology disruption"]});return{dealerId:a,model:{type:"competition",timeframe:"6months",confidence:f.confidence,factors:["market_share","pricing_strategy","digital_presence","customer_satisfaction"]},result:f,timestamp:new Date().toISOString(),data_points_used:b.length}}async function B(a,b,c){var d;let e={dealerId:a,currentAverage:b.average,growthRate:b.growth,seasonality:b.seasonality,timeframe:c};return d=(await (0,w.pL)(`Predict revenue for ${c} based on current performance: average ${b.average}, growth rate ${b.growth}%, seasonality ${b.seasonality}.`,e,"openai")).content,{predicted_value:1.12*b.average,confidence:.82,key_drivers:["Market expansion","Service improvements","Digital optimization"],recommendations:["Focus on high-margin services","Expand digital marketing","Optimize pricing strategy"],risk_factors:["Economic uncertainty","Supply chain disruptions","Increased competition"]}}async function C(a){return{voiceSearchGrowth:.15,localSearchImportance:.85,mobileTrafficShare:.73,competitiveDensity:"high"}}function D(a){return{hasSeasonality:a.length>=12,adjustment:0,pattern:"none"}}let E=(0,v.ru)(async(a,b)=>{try{let c,{predictionType:d,dealerId:e,timeframe:f="3months",historicalData:g=[]}=await a.json();if(e&&!(0,v.CX)(b,e))return u.NextResponse.json({error:"Access denied - Cannot access dealer analytics"},{status:403});if(!d)return u.NextResponse.json({error:"Prediction type is required"},{status:400});switch(d){case"revenue":c=await x(e,g,f);break;case"visibility":let h=await G(e),i=await H(e);c=await y(e,h,i);break;case"customer_behavior":let j=await I(e);c=await z(e,j);break;case"competition":let k=await H(e);c=await A(e,k);break;default:return u.NextResponse.json({error:"Invalid prediction type"},{status:400})}return await J(b.user.id,e,d,c.result.confidence),u.NextResponse.json({success:!0,prediction:c,generated_at:new Date().toISOString(),user_id:b.user.id})}catch(a){return console.error("Prediction API error:",a),u.NextResponse.json({error:"Failed to generate prediction",details:a.message},{status:500})}}),F=(0,v.ru)(async(a,b)=>{try{let{searchParams:c}=new URL(a.url),d=c.get("dealerId");if(d&&!(0,v.CX)(b,d))return u.NextResponse.json({error:"Access denied"},{status:403});let e=await K(d,b.user.id);return u.NextResponse.json({recent_predictions:e,available_models:[{type:"revenue",description:"Predict monthly revenue based on historical performance and market trends",timeframes:["1month","3months","6months","12months"],confidence_range:"75-90%"},{type:"visibility",description:"Forecast AI visibility improvements based on SEO and competitive analysis",timeframes:["1month","3months","6months"],confidence_range:"70-85%"},{type:"customer_behavior",description:"Predict customer lifetime value and retention patterns",timeframes:["3months","6months","12months"],confidence_range:"65-80%"},{type:"competition",description:"Analyze competitive threats and market positioning changes",timeframes:["3months","6months","12months"],confidence_range:"60-75%"}],usage_stats:{predictions_this_month:e.length,accuracy_rate:"82%",most_requested:"revenue"}})}catch(a){return console.error("Get predictions error:",a),u.NextResponse.json({error:"Failed to fetch predictions"},{status:500})}});async function G(a){try{return{aiVisibility:67,seoScore:74,localRanking:3,monthlyTraffic:12500,conversionRate:.034,trends:[{month:"Jan",score:62},{month:"Feb",score:65},{month:"Mar",score:67},{month:"Apr",score:69},{month:"May",score:67}]}}catch(a){return console.error("Error fetching current metrics:",a),{}}}async function H(a){try{return[{name:"Competitor A",aiVisibility:78,marketShare:.23,overallScore:82,strengths:["Digital presence","Customer reviews"],weaknesses:["Pricing","Inventory selection"]},{name:"Competitor B",aiVisibility:71,marketShare:.18,overallScore:75,strengths:["Location","Brand reputation"],weaknesses:["Digital marketing","Website UX"]},{name:"Competitor C",aiVisibility:84,marketShare:.31,overallScore:88,strengths:["SEO","Content marketing","Social media"],weaknesses:["Customer service","Pricing transparency"]}]}catch(a){return console.error("Error fetching competitor data:",a),[]}}async function I(a){try{return Array.from({length:50},(a,b)=>({customerId:`customer_${b}`,purchaseValue:5e4*Math.random()+15e3,purchaseFrequency:.5*Math.random()+.1,lifespanMonths:60*Math.random()+24,satisfactionScore:2*Math.random()+3,digitalEngagement:Math.random(),serviceInteractions:Math.floor(12*Math.random()),referrals:Math.floor(3*Math.random())}))}catch(a){return console.error("Error fetching customer data:",a),[]}}async function J(a,b,c,d){try{console.log(`Prediction logged: ${c} for ${b} by ${a}, confidence: ${d}`)}catch(a){console.error("Error logging prediction:",a)}}async function K(a,b){try{return[{id:"pred_001",type:"revenue",dealerId:a,predicted_value:892e3,confidence:.85,created_at:new Date(Date.now()-864e5).toISOString()},{id:"pred_002",type:"visibility",dealerId:a,predicted_value:73,confidence:.78,created_at:new Date(Date.now()-2592e5).toISOString()},{id:"pred_003",type:"customer_behavior",dealerId:a,predicted_value:4250,confidence:.71,created_at:new Date(Date.now()-6048e5).toISOString()}]}catch(a){return console.error("Error fetching recent predictions:",a),[]}}let L=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/analytics/predictions/route",pathname:"/api/analytics/predictions",filename:"route",bundlePath:"app/api/analytics/predictions/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/briankramer/dealership-ai/apps/web/app/api/analytics/predictions/route.ts",nextConfigOutput:"standalone",userland:d}),{workAsyncStorage:M,workUnitAsyncStorage:N,serverHooks:O}=L;function P(){return(0,g.patchFetch)({workAsyncStorage:M,workUnitAsyncStorage:N})}async function Q(a,b,c){var d;let e="/api/analytics/predictions/route";"/index"===e&&(e="/");let g=await L.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||L.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===L.isDev||!E,H=E&&!G,I=a.method||"GET",J=(0,i.getTracer)(),K=J.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>L.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>L.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!E)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await L.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})},z),b}},l=await L.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};K?await g(K):await J.withPropagatedContext(a.headers,()=>J.trace(m.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},g))}catch(b){if(K||b instanceof s.NoFallbackError||await L.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:a=>{a.exports=require("zlib")},79428:a=>{a.exports=require("buffer")},79551:a=>{a.exports=require("url")},81630:a=>{a.exports=require("http")},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},94735:a=>{a.exports=require("events")},96330:a=>{a.exports=require("@prisma/client")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[6118,810,3224,8298],()=>b(b.s=57265));module.exports=c})();