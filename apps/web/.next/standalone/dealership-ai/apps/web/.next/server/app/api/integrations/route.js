"use strict";(()=>{var a={};a.id=4871,a.ids=[4871],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:a=>{a.exports=require("bcrypt")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{a.exports=require("querystring")},12412:a=>{a.exports=require("assert")},19121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},28354:a=>{a.exports=require("util")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},49817:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>K,patchFetch:()=>J,routeModule:()=>F,serverHooks:()=>I,workAsyncStorage:()=>G,workUnitAsyncStorage:()=>H});var d={};c.r(d),c.d(d,{GET:()=>D,POST:()=>E});var e=c(30480),f=c(24037),g=c(45492),h=c(39414),i=c(56540),j=c(261),k=c(89594),l=c(46344),m=c(81288),n=c(18123),o=c(96357),p=c(24807),q=c(51689),r=c(46494),s=c(86439),t=c(2548),u=c(35497),v=c(26315),w=c(68382);let x={autotrader:{name:"AutoTrader API",enabled:!!process.env.AUTOTRADER_API_KEY,apiKey:process.env.AUTOTRADER_API_KEY,baseUrl:"https://api.autotrader.com/v1",rateLimit:{requests:100,window:3600},features:["vehicle-listings","market-data","pricing-analysis","inventory-sync"]},carscom:{name:"Cars.com API",enabled:!!process.env.CARSCOM_API_KEY,apiKey:process.env.CARSCOM_API_KEY,baseUrl:"https://api.cars.com/v1",rateLimit:{requests:50,window:3600},features:["listings-management","lead-generation","market-insights","competitor-analysis"]},facebook:{name:"Facebook Business API",enabled:!!process.env.FACEBOOK_ACCESS_TOKEN,apiKey:process.env.FACEBOOK_ACCESS_TOKEN,baseUrl:"https://graph.facebook.com/v18.0",rateLimit:{requests:200,window:3600},features:["social-posts","ad-performance","audience-insights","lead-ads"]},instagram:{name:"Instagram Business API",enabled:!!process.env.INSTAGRAM_ACCESS_TOKEN,apiKey:process.env.INSTAGRAM_ACCESS_TOKEN,baseUrl:"https://graph.facebook.com/v18.0",rateLimit:{requests:200,window:3600},features:["content-management","story-insights","hashtag-performance"]},google:{name:"Google My Business API",enabled:!!process.env.GOOGLE_BUSINESS_API_KEY,apiKey:process.env.GOOGLE_BUSINESS_API_KEY,baseUrl:"https://mybusinessbusinessinformation.googleapis.com/v1",rateLimit:{requests:1e3,window:3600},features:["business-profile","reviews-management","posts","insights"]},edmunds:{name:"Edmunds Vehicle API",enabled:!!process.env.EDMUNDS_API_KEY,apiKey:process.env.EDMUNDS_API_KEY,baseUrl:"https://api.edmunds.com/api/vehicle/v2",rateLimit:{requests:500,window:3600},features:["vehicle-data","pricing-info","reviews","specifications"]}};class y{constructor(){this.config=x.autotrader}async getVehicleListings(a,b={}){if(!this.config.enabled)return this.getMockVehicleData();try{let c=new URLSearchParams({dealer_id:a,make:b.make||"",model:b.model||"",year_min:b.yearMin||"2020",year_max:b.yearMax||"2024",price_min:b.priceMin||"0",price_max:b.priceMax||"100000",mileage_max:b.mileageMax||"50000"}),d=await fetch(`${this.config.baseUrl}/listings?${c}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});if(!d.ok)throw Error(`AutoTrader API error: ${d.statusText}`);let e=await d.json();return this.processAutoTraderData(e)}catch(a){return console.error("AutoTrader API error:",a),this.getMockVehicleData()}}async syncInventory(a,b){if(!this.config.enabled)return console.log("AutoTrader sync simulated - would sync",b.length,"vehicles"),{success:!0,synced:b.length,errors:0};try{let c=await fetch(`${this.config.baseUrl}/dealers/${a}/inventory`,{method:"POST",headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({vehicles:b})});return await c.json()}catch(a){return console.error("AutoTrader inventory sync error:",a),{success:!1,error:a.message}}}getMockVehicleData(){return{listings:[{id:"AT001",make:"Toyota",model:"Camry",year:2023,price:28500,mileage:12e3,color:"Silver",features:["Navigation","Backup Camera","Bluetooth"],images:["/api/placeholder/vehicle1.jpg"],status:"available"},{id:"AT002",make:"Honda",model:"Accord",year:2022,price:26900,mileage:18500,color:"Black",features:["Leather Seats","Sunroof","Remote Start"],images:["/api/placeholder/vehicle2.jpg"],status:"available"}],total:47,page:1,per_page:2}}processAutoTraderData(a){return{listings:a.listings?.map(a=>({id:a.id,make:a.make,model:a.model,year:a.year,price:a.price,mileage:a.mileage,color:a.exterior_color,features:a.features||[],images:a.photos?.map(a=>a.url)||[],status:a.availability}))||[],total:a.total_count||0,page:a.page||1,per_page:a.per_page||10}}}class z{constructor(){this.config=x.carscom}async getMarketInsights(a,b,c){if(!this.config.enabled)return this.getMockMarketInsights(b,c);try{let d=await fetch(`${this.config.baseUrl}/market/insights`,{method:"POST",headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({dealer_id:a,make:b,model:c,radius_miles:50})}),e=await d.json();return this.processMarketData(e)}catch(a){return console.error("Cars.com market insights error:",a),this.getMockMarketInsights(b,c)}}async getLeadMetrics(a,b="30d"){if(!this.config.enabled)return this.getMockLeadMetrics();try{let c=await fetch(`${this.config.baseUrl}/dealers/${a}/leads/metrics?range=${b}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});return await c.json()}catch(a){return console.error("Cars.com lead metrics error:",a),this.getMockLeadMetrics()}}getMockMarketInsights(a,b){return{market_analysis:{make:a,model:b,average_price:28750,price_range:{min:22e3,max:36e3},days_on_market:34,inventory_levels:"moderate",demand_trend:"increasing",competitive_density:"high"},recommendations:["Price competitively within $2,000 of market average","Highlight unique features to differentiate","Consider certified pre-owned programs","Optimize listings with high-quality photos"],competitors:[{name:"Competitor A",inventory_count:12,avg_price:29200},{name:"Competitor B",inventory_count:8,avg_price:27800},{name:"Competitor C",inventory_count:15,avg_price:30100}]}}getMockLeadMetrics(){return{period:"30 days",total_leads:89,qualified_leads:67,conversion_rate:.24,average_response_time:"2.3 hours",lead_sources:[{source:"Cars.com",leads:34,conversion:.29},{source:"AutoTrader",leads:28,conversion:.21},{source:"Direct Website",leads:19,conversion:.32},{source:"Social Media",leads:8,conversion:.15}],trends:[{date:"2024-01-01",leads:12},{date:"2024-01-02",leads:15},{date:"2024-01-03",leads:9},{date:"2024-01-04",leads:18}]}}processMarketData(a){return{market_analysis:{make:a.make,model:a.model,average_price:a.pricing?.average||0,price_range:a.pricing?.range||{min:0,max:0},days_on_market:a.market_metrics?.days_on_market||0,inventory_levels:a.market_metrics?.inventory_level||"unknown",demand_trend:a.market_metrics?.demand_trend||"stable",competitive_density:a.competitive_analysis?.density||"moderate"},recommendations:a.recommendations||[],competitors:a.competitors?.map(a=>({name:a.name,inventory_count:a.inventory_count,avg_price:a.average_price}))||[]}}}class A{constructor(){this.fbConfig=x.facebook,this.igConfig=x.instagram}async getFacebookInsights(a,b=["page_views","page_likes","post_engagements"]){if(!this.fbConfig.enabled)return this.getMockFacebookInsights();try{let c=b.join(","),d=await fetch(`${this.fbConfig.baseUrl}/${a}/insights?metric=${c}&access_token=${this.fbConfig.apiKey}`),e=await d.json();return this.processFacebookInsights(e)}catch(a){return console.error("Facebook insights error:",a),this.getMockFacebookInsights()}}async postToFacebook(a,b,c){if(!this.fbConfig.enabled)return console.log("Facebook post simulated:",b),{success:!0,post_id:"mock_123",message:"Post created successfully"};try{let d={message:b,access_token:this.fbConfig.apiKey};c&&(d.url=c);let e=await fetch(`${this.fbConfig.baseUrl}/${a}/feed`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});return await e.json()}catch(a){return console.error("Facebook posting error:",a),{success:!1,error:a.message}}}async getInstagramInsights(a){if(!this.igConfig.enabled)return this.getMockInstagramInsights();try{let b=await fetch(`${this.igConfig.baseUrl}/${a}/insights?metric=impressions,reach,profile_views&access_token=${this.igConfig.apiKey}`);return await b.json()}catch(a){return console.error("Instagram insights error:",a),this.getMockInstagramInsights()}}getMockFacebookInsights(){return{page_views:1247,page_likes:823,post_engagements:456,reach:3421,impressions:8934,engagement_rate:.067,top_posts:[{id:"post_1",message:"New 2024 Toyota Camry arrivals!",engagement:89,reach:1234}]}}getMockInstagramInsights(){return{impressions:5672,reach:4123,profile_views:234,website_clicks:67,follower_count:1834,growth_rate:.023}}processFacebookInsights(a){let b={};return a.data?.forEach(a=>{b[a.name]=a.values?.[0]?.value||0}),b}}class B{constructor(){this.config=x.google}async getBusinessProfile(a){if(!this.config.enabled)return this.getMockBusinessProfile();try{let b=await fetch(`${this.config.baseUrl}/locations/${a}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});return await b.json()}catch(a){return console.error("Google My Business profile error:",a),this.getMockBusinessProfile()}}async getReviews(a){if(!this.config.enabled)return this.getMockReviews();try{let b=await fetch(`${this.config.baseUrl}/locations/${a}/reviews`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}}),c=await b.json();return this.processReviews(c)}catch(a){return console.error("Google My Business reviews error:",a),this.getMockReviews()}}getMockBusinessProfile(){return{name:"Toyota of Naples",address:"2875 Airport Rd S, Naples, FL 34112",phone:"(239) 775-6010",website:"https://www.toyotanaples.com",rating:4.6,review_count:1247,hours:[{day:"MONDAY",open:"08:00",close:"21:00"},{day:"TUESDAY",open:"08:00",close:"21:00"},{day:"WEDNESDAY",open:"08:00",close:"21:00"},{day:"THURSDAY",open:"08:00",close:"21:00"},{day:"FRIDAY",open:"08:00",close:"21:00"},{day:"SATURDAY",open:"08:00",close:"20:00"},{day:"SUNDAY",open:"10:00",close:"18:00"}]}}getMockReviews(){return{reviews:[{reviewer:"John D.",rating:5,text:"Excellent service and great selection of vehicles!",date:"2024-01-15"},{reviewer:"Sarah M.",rating:4,text:"Good experience overall, helpful staff.",date:"2024-01-12"},{reviewer:"Mike R.",rating:5,text:"Quick and professional service department.",date:"2024-01-10"}],average_rating:4.6,total_reviews:1247,recent_rating_distribution:{5:823,4:267,3:89,2:34,1:34}}}processReviews(a){return{reviews:a.reviews?.map(a=>({reviewer:a.reviewer?.displayName||"Anonymous",rating:a.starRating,text:a.comment,date:a.createTime}))||[],average_rating:a.averageRating||0,total_reviews:a.totalReviewCount||0}}}class C{constructor(){this.autotrader=new y,this.carscom=new z,this.social=new A,this.gmb=new B}async getComprehensiveMarketData(a,b,c){try{let[d,e,f,g]=await Promise.allSettled([this.autotrader.getVehicleListings(a,{make:b,model:c}),b&&c?this.carscom.getMarketInsights(a,b,c):null,this.social.getFacebookInsights("dealership_page_id"),this.gmb.getBusinessProfile("gmb_location_id")]);return{vehicle_inventory:"fulfilled"===d.status?d.value:null,market_insights:"fulfilled"===e.status?e.value:null,social_metrics:"fulfilled"===f.status?f.value:null,business_profile:"fulfilled"===g.status?g.value:null,generated_at:new Date().toISOString()}}catch(a){throw console.error("Comprehensive market data error:",a),a}}async generateMarketingRecommendations(a,b){return{ai_recommendations:(await (0,w.pL)("Analyze the provided market data and generate specific marketing recommendations for this dealership. Focus on actionable strategies for inventory optimization, pricing, digital marketing, and customer engagement.",{dealerId:a,marketData:b,integrationSources:["AutoTrader","Cars.com","Facebook","Google My Business"]},"claude")).content,data_sources:Object.keys(x).filter(a=>x[a].enabled),confidence_score:.87,last_updated:new Date().toISOString()}}getIntegrationStatus(){return Object.entries(x).map(([a,b])=>({name:b.name,key:a,enabled:b.enabled,features:b.features,rate_limit:b.rateLimit}))}}let D=(0,v.ru)(async(a,b)=>{try{let{searchParams:c}=new URL(a.url),d=c.get("dealerId"),e=c.get("action")||"status";if(d&&!(0,v.CX)(b,d))return u.NextResponse.json({error:"Access denied"},{status:403});let f=new C;switch(e){case"status":let g=f.getIntegrationStatus();return u.NextResponse.json({integrations:g,enabled_count:g.filter(a=>a.enabled).length,total_features:g.reduce((a,b)=>a+b.features.length,0)});case"market-data":if(!d)return u.NextResponse.json({error:"Dealer ID required for market data"},{status:400});let h=c.get("make"),i=c.get("model"),j=await f.getComprehensiveMarketData(d,h||void 0,i||void 0);return u.NextResponse.json({success:!0,data:j,dealer_id:d,generated_at:new Date().toISOString()});case"recommendations":if(!d)return u.NextResponse.json({error:"Dealer ID required for recommendations"},{status:400});let k=await f.getComprehensiveMarketData(d),l=await f.generateMarketingRecommendations(d,k);return u.NextResponse.json({success:!0,recommendations:l,dealer_id:d});default:return u.NextResponse.json({error:"Invalid action parameter"},{status:400})}}catch(a){return console.error("Integrations API error:",a),u.NextResponse.json({error:"Failed to process integration request",details:a.message},{status:500})}}),E=(0,v.ru)(async(a,b)=>{try{let{action:c,dealerId:d,...e}=await a.json();if(d&&!(0,v.CX)(b,d))return u.NextResponse.json({error:"Access denied"},{status:403});let f=new C;switch(c){case"sync-inventory":if(!d||!e.inventory)return u.NextResponse.json({error:"Dealer ID and inventory data required"},{status:400});let g=await f.autotrader.syncInventory(d,e.inventory);return u.NextResponse.json({success:g.success,result:g,synced_at:new Date().toISOString()});case"post-social":let h;if(!e.platform||!e.content)return u.NextResponse.json({error:"Platform and content required"},{status:400});if("facebook"!==e.platform)return u.NextResponse.json({error:"Unsupported social platform"},{status:400});return h=await f.social.postToFacebook(e.pageId||"default_page",e.content,e.imageUrl),u.NextResponse.json({success:h.success,result:h,posted_at:new Date().toISOString()});case"fetch-reviews":if(!d)return u.NextResponse.json({error:"Dealer ID required"},{status:400});let i=await f.gmb.getReviews(e.locationId||"default_location");return u.NextResponse.json({success:!0,reviews:i,dealer_id:d,fetched_at:new Date().toISOString()});case"get-lead-metrics":if(!d)return u.NextResponse.json({error:"Dealer ID required"},{status:400});let j=await f.carscom.getLeadMetrics(d,e.dateRange);return u.NextResponse.json({success:!0,metrics:j,dealer_id:d,period:e.dateRange||"30d"});default:return u.NextResponse.json({error:"Invalid action"},{status:400})}}catch(a){return console.error("Integration action error:",a),u.NextResponse.json({error:"Failed to execute integration action",details:a.message},{status:500})}}),F=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/integrations/route",pathname:"/api/integrations",filename:"route",bundlePath:"app/api/integrations/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/briankramer/dealership-ai/apps/web/app/api/integrations/route.ts",nextConfigOutput:"standalone",userland:d}),{workAsyncStorage:G,workUnitAsyncStorage:H,serverHooks:I}=F;function J(){return(0,g.patchFetch)({workAsyncStorage:G,workUnitAsyncStorage:H})}async function K(a,b,c){var d;let e="/api/integrations/route";"/index"===e&&(e="/");let g=await F.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!E||F.isDev||x||(G="/index"===(G=C)?"/":G);let H=!0===F.isDev||!E,I=E&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>F.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>F.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!E)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await F.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await F.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||b instanceof s.NoFallbackError||await F.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},55511:a=>{a.exports=require("crypto")},55591:a=>{a.exports=require("https")},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:a=>{a.exports=require("zlib")},79428:a=>{a.exports=require("buffer")},79551:a=>{a.exports=require("url")},81630:a=>{a.exports=require("http")},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},94735:a=>{a.exports=require("events")},96330:a=>{a.exports=require("@prisma/client")}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[6118,810,3224,8298],()=>b(b.s=49817));module.exports=c})();