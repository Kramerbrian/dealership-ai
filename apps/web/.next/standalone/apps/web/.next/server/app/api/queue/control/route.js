"use strict";(()=>{var e={};e.id=9306,e.ids=[9306],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},24356:(e,r,s)=>{s.r(r),s.d(r,{headerHooks:()=>g,originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>q});var t={};s.r(t),s.d(t,{POST:()=>c});var a=s(95815),i=s(51150),n=s(10007),o=s(30596),u=s(2381),d=s(90453),l=s(11123);async function c(e){try{let r,s;let t=await d.Sy.authenticateRequest(e);if(!t||!d.Sy.hasPermission(t,"write:admin"))return o.Z.json({error:"Admin access required"},{status:403});let{action:a,options:i={}}=await e.json();if(!a)return o.Z.json({error:"action is required"},{status:400});switch(a){case"pause":await l.c.pause(),r=!0,s="Queue paused";break;case"resume":await l.c.resume(),r=!0,s="Queue resumed";break;case"clear":let n=await l.c.clear(i.status);r=!0,s=`Cleared ${n} jobs`;break;case"stats":r=await l.c.getMetrics(),s="Queue statistics retrieved";break;default:return o.Z.json({error:`Unknown action: ${a}`},{status:400})}return u.kg.info("Queue control action executed",{action:a,userId:t.id,options:i}),o.Z.json({success:!0,result:r,message:s,timestamp:new Date().toISOString()})}catch(e){return u.kg.error("Queue control error",e instanceof Error?e:Error(String(e))),o.Z.json({error:"Failed to execute queue control action",details:e instanceof Error?e.message:String(e)},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/queue/control/route",pathname:"/api/queue/control",filename:"route",bundlePath:"app/api/queue/control/route"},resolvedPagePath:"/Users/briankramer/Documents/GitHub/dealership-ai/apps/web/app/api/queue/control/route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:w,headerHooks:g,staticGenerationBailout:q}=h,f="/api/queue/control/route";function y(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:m})}},90453:(e,r,s)=>{s.d(r,{Sy:()=>u});var t=s(2381);let a={admin:["read:dashboard","write:dashboard","read:batches","write:batches","read:queue","write:queue","read:admin","write:admin","read:costs","write:costs"],dealer:["read:dashboard","write:dashboard","read:batches","write:batches","read:queue","read:costs"],user:["read:dashboard","read:batches","read:queue"],viewer:["read:dashboard"]};class i{async createSession(e){let r=this.generateSessionId(),s=new Date;s.setHours(s.getHours()+24);let a={userId:e.id,user:e,expiresAt:s,createdAt:new Date};return this.sessions.set(r,a),t.kg.info("Session created",{userId:e.id,sessionId:r.substring(0,8)+"...",expiresAt:s}),r}async getSession(e){let r=this.sessions.get(e);return r?new Date>r.expiresAt?(this.sessions.delete(e),t.kg.info("Session expired",{userId:r.userId}),null):r:null}async deleteSession(e){let r=this.sessions.get(e);r&&(this.sessions.delete(e),t.kg.info("Session deleted",{userId:r.userId}))}async refreshSession(e){let r=this.sessions.get(e);r&&(r.expiresAt=new Date,r.expiresAt.setHours(r.expiresAt.getHours()+24))}generateSessionId(){return crypto.randomUUID()}async cleanupExpiredSessions(){let e=new Date,r=0;for(let[s,t]of this.sessions.entries())e>t.expiresAt&&(this.sessions.delete(s),r++);r>0&&t.kg.info("Cleaned up expired sessions",{count:r})}constructor(){this.sessions=new Map}}class n{constructor(){this.sessionManager=new i,setInterval(()=>{this.sessionManager.cleanupExpiredSessions()},36e5)}hasPermission(e,r){return e.permissions.includes(r)||a[e.role]?.includes(r)}hasAnyPermission(e,r){return r.some(r=>this.hasPermission(e,r))}hasAllPermissions(e,r){return r.every(r=>this.hasPermission(e,r))}canAccessDealer(e,r){return"admin"===e.role||e.dealerId===r}async authenticateRequest(e){try{let r=e.headers.get("authorization"),s=null;if(r&&r.startsWith("Bearer ")&&(s=r.substring(7)),s||(s=e.cookies.get("session")?.value||null),!s)return null;let t=await this.sessionManager.getSession(s);if(!t)return null;return await this.sessionManager.refreshSession(s),t.user}catch(e){return t.kg.error("Authentication error",e instanceof Error?e:Error(String(e))),null}}async createUserSession(e){return await this.sessionManager.createSession(e)}async logout(e){await this.sessionManager.deleteSession(e)}requireAuth(){return async e=>{let r=await this.authenticateRequest(e);if(!r)throw Error("Authentication required");return r}}requirePermission(e){return async r=>{let s=await this.authenticateRequest(r);if(!s)throw Error("Authentication required");if(!this.hasPermission(s,e))throw Error(`Permission required: ${e}`);return s}}requireDealer(e){return async r=>{let s=await this.authenticateRequest(r);if(!s)throw Error("Authentication required");if(!this.canAccessDealer(s,e))throw Error("Access to dealer not allowed");return s}}}class o{constructor(){this.users=new Map,this.users.set("admin@dealershipai.com",{id:"admin-1",email:"admin@dealershipai.com",role:"admin",permissions:[],metadata:{name:"Admin User",createdAt:new Date}}),this.users.set("dealer@toyota-naples.com",{id:"dealer-1",email:"dealer@toyota-naples.com",role:"dealer",dealerId:"toyota-naples",permissions:[],metadata:{name:"Toyota Naples",createdAt:new Date}}),this.users.set("user@example.com",{id:"user-1",email:"user@example.com",role:"user",dealerId:"toyota-naples",permissions:[],metadata:{name:"Demo User",createdAt:new Date}})}async findByEmail(e){return this.users.get(e)||null}async findById(e){for(let r of this.users.values())if(r.id===e)return r;return null}async createUser(e){let r={...e,id:`user-${Date.now()}`,permissions:a[e.role]||[],metadata:{createdAt:new Date}};return this.users.set(r.email,r),r}async updateUser(e,r){let s=await this.findById(e);if(!s)return null;let t={...s,...r};return this.users.set(s.email,t),t}}let u=new n;new o}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[1262,722,1123],()=>s(24356));module.exports=t})();