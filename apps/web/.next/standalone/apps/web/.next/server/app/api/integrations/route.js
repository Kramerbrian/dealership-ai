"use strict";(()=>{var e={};e.id=8034,e.ids=[8034],e.modules={53524:e=>{e.exports=require("@prisma/client")},67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},55441:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>b,originalPathname:()=>I,patchFetch:()=>M,requestAsyncStorage:()=>_,routeModule:()=>v,serverHooks:()=>k,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>A});var a={};r.r(a),r.d(a,{GET:()=>f,POST:()=>y});var s=r(95815),i=r(51150),o=r(10007),n=r(30596),c=r(59001),l=r(89267);let u={autotrader:{name:"AutoTrader API",enabled:!!process.env.AUTOTRADER_API_KEY,apiKey:process.env.AUTOTRADER_API_KEY,baseUrl:"https://api.autotrader.com/v1",rateLimit:{requests:100,window:3600},features:["vehicle-listings","market-data","pricing-analysis","inventory-sync"]},carscom:{name:"Cars.com API",enabled:!!process.env.CARSCOM_API_KEY,apiKey:process.env.CARSCOM_API_KEY,baseUrl:"https://api.cars.com/v1",rateLimit:{requests:50,window:3600},features:["listings-management","lead-generation","market-insights","competitor-analysis"]},facebook:{name:"Facebook Business API",enabled:!!process.env.FACEBOOK_ACCESS_TOKEN,apiKey:process.env.FACEBOOK_ACCESS_TOKEN,baseUrl:"https://graph.facebook.com/v18.0",rateLimit:{requests:200,window:3600},features:["social-posts","ad-performance","audience-insights","lead-ads"]},instagram:{name:"Instagram Business API",enabled:!!process.env.INSTAGRAM_ACCESS_TOKEN,apiKey:process.env.INSTAGRAM_ACCESS_TOKEN,baseUrl:"https://graph.facebook.com/v18.0",rateLimit:{requests:200,window:3600},features:["content-management","story-insights","hashtag-performance"]},google:{name:"Google My Business API",enabled:!!process.env.GOOGLE_BUSINESS_API_KEY,apiKey:process.env.GOOGLE_BUSINESS_API_KEY,baseUrl:"https://mybusinessbusinessinformation.googleapis.com/v1",rateLimit:{requests:1e3,window:3600},features:["business-profile","reviews-management","posts","insights"]},edmunds:{name:"Edmunds Vehicle API",enabled:!!process.env.EDMUNDS_API_KEY,apiKey:process.env.EDMUNDS_API_KEY,baseUrl:"https://api.edmunds.com/api/vehicle/v2",rateLimit:{requests:500,window:3600},features:["vehicle-data","pricing-info","reviews","specifications"]}};class g{constructor(){this.config=u.autotrader}async getVehicleListings(e,t={}){if(!this.config.enabled)return this.getMockVehicleData();try{let r=new URLSearchParams({dealer_id:e,make:t.make||"",model:t.model||"",year_min:t.yearMin||"2020",year_max:t.yearMax||"2024",price_min:t.priceMin||"0",price_max:t.priceMax||"100000",mileage_max:t.mileageMax||"50000"}),a=await fetch(`${this.config.baseUrl}/listings?${r}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});if(!a.ok)throw Error(`AutoTrader API error: ${a.statusText}`);let s=await a.json();return this.processAutoTraderData(s)}catch(e){return console.error("AutoTrader API error:",e),this.getMockVehicleData()}}async syncInventory(e,t){if(!this.config.enabled)return console.log("AutoTrader sync simulated - would sync",t.length,"vehicles"),{success:!0,synced:t.length,errors:0};try{let r=await fetch(`${this.config.baseUrl}/dealers/${e}/inventory`,{method:"POST",headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({vehicles:t})});return await r.json()}catch(e){return console.error("AutoTrader inventory sync error:",e),{success:!1,error:e.message}}}getMockVehicleData(){return{listings:[{id:"AT001",make:"Toyota",model:"Camry",year:2023,price:28500,mileage:12e3,color:"Silver",features:["Navigation","Backup Camera","Bluetooth"],images:["/api/placeholder/vehicle1.jpg"],status:"available"},{id:"AT002",make:"Honda",model:"Accord",year:2022,price:26900,mileage:18500,color:"Black",features:["Leather Seats","Sunroof","Remote Start"],images:["/api/placeholder/vehicle2.jpg"],status:"available"}],total:47,page:1,per_page:2}}processAutoTraderData(e){return{listings:e.listings?.map(e=>({id:e.id,make:e.make,model:e.model,year:e.year,price:e.price,mileage:e.mileage,color:e.exterior_color,features:e.features||[],images:e.photos?.map(e=>e.url)||[],status:e.availability}))||[],total:e.total_count||0,page:e.page||1,per_page:e.per_page||10}}}class d{constructor(){this.config=u.carscom}async getMarketInsights(e,t,r){if(!this.config.enabled)return this.getMockMarketInsights(t,r);try{let a=await fetch(`${this.config.baseUrl}/market/insights`,{method:"POST",headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({dealer_id:e,make:t,model:r,radius_miles:50})}),s=await a.json();return this.processMarketData(s)}catch(e){return console.error("Cars.com market insights error:",e),this.getMockMarketInsights(t,r)}}async getLeadMetrics(e,t="30d"){if(!this.config.enabled)return this.getMockLeadMetrics();try{let r=await fetch(`${this.config.baseUrl}/dealers/${e}/leads/metrics?range=${t}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});return await r.json()}catch(e){return console.error("Cars.com lead metrics error:",e),this.getMockLeadMetrics()}}getMockMarketInsights(e,t){return{market_analysis:{make:e,model:t,average_price:28750,price_range:{min:22e3,max:36e3},days_on_market:34,inventory_levels:"moderate",demand_trend:"increasing",competitive_density:"high"},recommendations:["Price competitively within $2,000 of market average","Highlight unique features to differentiate","Consider certified pre-owned programs","Optimize listings with high-quality photos"],competitors:[{name:"Competitor A",inventory_count:12,avg_price:29200},{name:"Competitor B",inventory_count:8,avg_price:27800},{name:"Competitor C",inventory_count:15,avg_price:30100}]}}getMockLeadMetrics(){return{period:"30 days",total_leads:89,qualified_leads:67,conversion_rate:.24,average_response_time:"2.3 hours",lead_sources:[{source:"Cars.com",leads:34,conversion:.29},{source:"AutoTrader",leads:28,conversion:.21},{source:"Direct Website",leads:19,conversion:.32},{source:"Social Media",leads:8,conversion:.15}],trends:[{date:"2024-01-01",leads:12},{date:"2024-01-02",leads:15},{date:"2024-01-03",leads:9},{date:"2024-01-04",leads:18}]}}processMarketData(e){return{market_analysis:{make:e.make,model:e.model,average_price:e.pricing?.average||0,price_range:e.pricing?.range||{min:0,max:0},days_on_market:e.market_metrics?.days_on_market||0,inventory_levels:e.market_metrics?.inventory_level||"unknown",demand_trend:e.market_metrics?.demand_trend||"stable",competitive_density:e.competitive_analysis?.density||"moderate"},recommendations:e.recommendations||[],competitors:e.competitors?.map(e=>({name:e.name,inventory_count:e.inventory_count,avg_price:e.average_price}))||[]}}}class p{constructor(){this.fbConfig=u.facebook,this.igConfig=u.instagram}async getFacebookInsights(e,t=["page_views","page_likes","post_engagements"]){if(!this.fbConfig.enabled)return this.getMockFacebookInsights();try{let r=t.join(","),a=await fetch(`${this.fbConfig.baseUrl}/${e}/insights?metric=${r}&access_token=${this.fbConfig.apiKey}`),s=await a.json();return this.processFacebookInsights(s)}catch(e){return console.error("Facebook insights error:",e),this.getMockFacebookInsights()}}async postToFacebook(e,t,r){if(!this.fbConfig.enabled)return console.log("Facebook post simulated:",t),{success:!0,post_id:"mock_123",message:"Post created successfully"};try{let a={message:t,access_token:this.fbConfig.apiKey};r&&(a.url=r);let s=await fetch(`${this.fbConfig.baseUrl}/${e}/feed`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await s.json()}catch(e){return console.error("Facebook posting error:",e),{success:!1,error:e.message}}}async getInstagramInsights(e){if(!this.igConfig.enabled)return this.getMockInstagramInsights();try{let t=await fetch(`${this.igConfig.baseUrl}/${e}/insights?metric=impressions,reach,profile_views&access_token=${this.igConfig.apiKey}`);return await t.json()}catch(e){return console.error("Instagram insights error:",e),this.getMockInstagramInsights()}}getMockFacebookInsights(){return{page_views:1247,page_likes:823,post_engagements:456,reach:3421,impressions:8934,engagement_rate:.067,top_posts:[{id:"post_1",message:"New 2024 Toyota Camry arrivals!",engagement:89,reach:1234}]}}getMockInstagramInsights(){return{impressions:5672,reach:4123,profile_views:234,website_clicks:67,follower_count:1834,growth_rate:.023}}processFacebookInsights(e){let t={};return e.data?.forEach(e=>{t[e.name]=e.values?.[0]?.value||0}),t}}class m{constructor(){this.config=u.google}async getBusinessProfile(e){if(!this.config.enabled)return this.getMockBusinessProfile();try{let t=await fetch(`${this.config.baseUrl}/locations/${e}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});return await t.json()}catch(e){return console.error("Google My Business profile error:",e),this.getMockBusinessProfile()}}async getReviews(e){if(!this.config.enabled)return this.getMockReviews();try{let t=await fetch(`${this.config.baseUrl}/locations/${e}/reviews`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}}),r=await t.json();return this.processReviews(r)}catch(e){return console.error("Google My Business reviews error:",e),this.getMockReviews()}}getMockBusinessProfile(){return{name:"Toyota of Naples",address:"2875 Airport Rd S, Naples, FL 34112",phone:"(239) 775-6010",website:"https://www.toyotanaples.com",rating:4.6,review_count:1247,hours:[{day:"MONDAY",open:"08:00",close:"21:00"},{day:"TUESDAY",open:"08:00",close:"21:00"},{day:"WEDNESDAY",open:"08:00",close:"21:00"},{day:"THURSDAY",open:"08:00",close:"21:00"},{day:"FRIDAY",open:"08:00",close:"21:00"},{day:"SATURDAY",open:"08:00",close:"20:00"},{day:"SUNDAY",open:"10:00",close:"18:00"}]}}getMockReviews(){return{reviews:[{reviewer:"John D.",rating:5,text:"Excellent service and great selection of vehicles!",date:"2024-01-15"},{reviewer:"Sarah M.",rating:4,text:"Good experience overall, helpful staff.",date:"2024-01-12"},{reviewer:"Mike R.",rating:5,text:"Quick and professional service department.",date:"2024-01-10"}],average_rating:4.6,total_reviews:1247,recent_rating_distribution:{5:823,4:267,3:89,2:34,1:34}}}processReviews(e){return{reviews:e.reviews?.map(e=>({reviewer:e.reviewer?.displayName||"Anonymous",rating:e.starRating,text:e.comment,date:e.createTime}))||[],average_rating:e.averageRating||0,total_reviews:e.totalReviewCount||0}}}class h{constructor(){this.autotrader=new g,this.carscom=new d,this.social=new p,this.gmb=new m}async getComprehensiveMarketData(e,t,r){try{let[a,s,i,o]=await Promise.allSettled([this.autotrader.getVehicleListings(e,{make:t,model:r}),t&&r?this.carscom.getMarketInsights(e,t,r):null,this.social.getFacebookInsights("dealership_page_id"),this.gmb.getBusinessProfile("gmb_location_id")]);return{vehicle_inventory:"fulfilled"===a.status?a.value:null,market_insights:"fulfilled"===s.status?s.value:null,social_metrics:"fulfilled"===i.status?i.value:null,business_profile:"fulfilled"===o.status?o.value:null,generated_at:new Date().toISOString()}}catch(e){throw console.error("Comprehensive market data error:",e),e}}async generateMarketingRecommendations(e,t){return{ai_recommendations:(await (0,l.U6)("Analyze the provided market data and generate specific marketing recommendations for this dealership. Focus on actionable strategies for inventory optimization, pricing, digital marketing, and customer engagement.",{dealerId:e,marketData:t,integrationSources:["AutoTrader","Cars.com","Facebook","Google My Business"]},"claude")).content,data_sources:Object.keys(u).filter(e=>u[e].enabled),confidence_score:.87,last_updated:new Date().toISOString()}}getIntegrationStatus(){return Object.entries(u).map(([e,t])=>({name:t.name,key:e,enabled:t.enabled,features:t.features,rate_limit:t.rateLimit}))}}let f=(0,c.QO)(async(e,t)=>{try{let{searchParams:r}=new URL(e.url),a=r.get("dealerId"),s=r.get("action")||"status";if(a&&!(0,c.rP)(t,a))return n.Z.json({error:"Access denied"},{status:403});let i=new h;switch(s){case"status":let o=i.getIntegrationStatus();return n.Z.json({integrations:o,enabled_count:o.filter(e=>e.enabled).length,total_features:o.reduce((e,t)=>e+t.features.length,0)});case"market-data":if(!a)return n.Z.json({error:"Dealer ID required for market data"},{status:400});let l=r.get("make"),u=r.get("model"),g=await i.getComprehensiveMarketData(a,l||void 0,u||void 0);return n.Z.json({success:!0,data:g,dealer_id:a,generated_at:new Date().toISOString()});case"recommendations":if(!a)return n.Z.json({error:"Dealer ID required for recommendations"},{status:400});let d=await i.getComprehensiveMarketData(a),p=await i.generateMarketingRecommendations(a,d);return n.Z.json({success:!0,recommendations:p,dealer_id:a});default:return n.Z.json({error:"Invalid action parameter"},{status:400})}}catch(e){return console.error("Integrations API error:",e),n.Z.json({error:"Failed to process integration request",details:e.message},{status:500})}}),y=(0,c.QO)(async(e,t)=>{try{let{action:r,dealerId:a,...s}=await e.json();if(a&&!(0,c.rP)(t,a))return n.Z.json({error:"Access denied"},{status:403});let i=new h;switch(r){case"sync-inventory":if(!a||!s.inventory)return n.Z.json({error:"Dealer ID and inventory data required"},{status:400});let o=await i.autotrader.syncInventory(a,s.inventory);return n.Z.json({success:o.success,result:o,synced_at:new Date().toISOString()});case"post-social":let l;if(!s.platform||!s.content)return n.Z.json({error:"Platform and content required"},{status:400});if("facebook"!==s.platform)return n.Z.json({error:"Unsupported social platform"},{status:400});return l=await i.social.postToFacebook(s.pageId||"default_page",s.content,s.imageUrl),n.Z.json({success:l.success,result:l,posted_at:new Date().toISOString()});case"fetch-reviews":if(!a)return n.Z.json({error:"Dealer ID required"},{status:400});let u=await i.gmb.getReviews(s.locationId||"default_location");return n.Z.json({success:!0,reviews:u,dealer_id:a,fetched_at:new Date().toISOString()});case"get-lead-metrics":if(!a)return n.Z.json({error:"Dealer ID required"},{status:400});let g=await i.carscom.getLeadMetrics(a,s.dateRange);return n.Z.json({success:!0,metrics:g,dealer_id:a,period:s.dateRange||"30d"});default:return n.Z.json({error:"Invalid action"},{status:400})}}catch(e){return console.error("Integration action error:",e),n.Z.json({error:"Failed to execute integration action",details:e.message},{status:500})}}),v=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/integrations/route",pathname:"/api/integrations",filename:"route",bundlePath:"app/api/integrations/route"},resolvedPagePath:"/Users/briankramer/Documents/GitHub/dealership-ai/apps/web/app/api/integrations/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:_,staticGenerationAsyncStorage:w,serverHooks:k,headerHooks:b,staticGenerationBailout:A}=v,I="/api/integrations/route";function M(){return(0,o.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:w})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1262,722,1894,9210],()=>r(55441));module.exports=a})();