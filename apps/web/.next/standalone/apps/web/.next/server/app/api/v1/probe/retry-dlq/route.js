"use strict";(()=>{var e={};e.id=4121,e.ids=[4121],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},12781:e=>{e.exports=require("stream")},71576:e=>{e.exports=require("string_decoder")},24404:e=>{e.exports=require("tls")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},22670:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>g,originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>y,staticGenerationAsyncStorage:()=>q,staticGenerationBailout:()=>x});var o={};t.r(o),t.d(o,{POST:()=>c});var a=t(95815),i=t(51150),s=t(10007),n=t(30596),d=t(2381),u=t(11123);function l(e){let r=JSON.stringify(e,Object.keys(e).sort()),t=0;for(let e=0;e<r.length;e++)t=(t<<5)-t+r.charCodeAt(e),t&=t;return Math.abs(t).toString(36)}async function p(e){try{let{jobIds:r,limit:t=50,force:o=!1}=await e.json(),a=0;if(r&&Array.isArray(r))for(let e of r){let r=await u.c.get(e);if(r&&"failed"===r.status){let t=o?void 0:`probe:${r.metadata.dealer}:${l({queries:r.payload.queries,platforms:r.payload.platforms})}`;r.status="pending",r.attempts=0,r.error=void 0,r.startedAt=void 0,r.completedAt=void 0,await u.c.add(r.type,r.payload,{priority:r.priority,maxAttempts:r.maxAttempts,metadata:r.metadata}),a++,d.kg.info("Job retried from DLQ",{originalJobId:e,force:o,newJobId:t||"generated"})}}else if(t)for(let e of(await u.c.getJobsByStatus("failed")).slice(0,t)){let r=o?void 0:`probe:${e.metadata.dealer}:${l({queries:e.payload.queries,platforms:e.payload.platforms})}`;e.status="pending",e.attempts=0,e.error=void 0,e.startedAt=void 0,e.completedAt=void 0,await u.c.add(e.type,e.payload,{priority:e.priority,maxAttempts:e.maxAttempts,metadata:e.metadata}),a++,d.kg.info("Job retried from DLQ",{originalJobId:e.id,force:o,newJobId:r||"generated"})}return n.Z.json({success:!0,retriedCount:a,message:`Successfully retried ${a} jobs from DLQ`})}catch(e){return d.kg.error("DLQ retry API error",e instanceof Error?e:Error(String(e))),n.Z.json({success:!1,error:"Failed to retry jobs from DLQ",message:e instanceof Error?e.message:String(e)},{status:500})}}let c=(0,t(72225).c2)(p),m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/v1/probe/retry-dlq/route",pathname:"/api/v1/probe/retry-dlq",filename:"route",bundlePath:"app/api/v1/probe/retry-dlq/route"},resolvedPagePath:"/Users/briankramer/Documents/GitHub/dealership-ai/apps/web/app/api/v1/probe/retry-dlq/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:q,serverHooks:y,headerHooks:g,staticGenerationBailout:x}=m,b="/api/v1/probe/retry-dlq/route";function v(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:q})}},72225:(e,r,t)=>{t.d(r,{c2:()=>s,do:()=>d,vG:()=>u,xq:()=>n});var o=t(30596),a=t(44955);function i(e,r={}){return async t=>{let{roles:i=[],requireDealerId:s=!1,bypassInDevelopment:n=!0}=r;try{let r=await (0,a.getToken)({req:t,secret:process.env.NEXTAUTH_SECRET});if(!r)return o.Z.json({error:"Authentication required"},{status:401});let n={id:r.sub,email:r.email,name:r.name,role:r.role,dealerId:r.dealerId};if(i.length>0&&!i.includes(n.role))return o.Z.json({error:"Insufficient permissions",required:i,current:n.role},{status:403});if(s&&!n.dealerId)return o.Z.json({error:"Dealer association required"},{status:403});return t.user=n,e(t)}catch(e){return console.error("Auth middleware error:",e),o.Z.json({error:"Authentication verification failed"},{status:500})}}}function s(e){return i(e,{roles:["admin"]})}function n(e){return i(e,{roles:["admin","dealer"],requireDealerId:!0})}function d(e,r,t){return"admin"===t||("dealer"===t||"user"===t)&&r===e}function u(e){let{searchParams:r,pathname:t}=new URL(e.url),o=r.get("dealerId");if(o)return o;let a=t.split("/"),i=a.indexOf("dealer");if(-1!==i&&a[i+1])return a[i+1]}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1262,722,4955,1123],()=>t(22670));module.exports=o})();