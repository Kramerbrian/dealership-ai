"use strict";exports.id=9210,exports.ids=[9210],exports.modules={89267:(e,t,r)=>{r.d(t,{Cf:()=>p,TN:()=>g,U6:()=>l});var n=r(1461),a=r(19336);let i={openai:{name:"OpenAI",model:"gpt-4-turbo-preview",maxTokens:4096,temperature:.7},claude:{name:"Anthropic Claude",model:"claude-3-sonnet-20240229",maxTokens:4096,temperature:.7}},o=new n.ZP({apiKey:process.env.OPENAI_API_KEY}),s=new a.ZP({apiKey:process.env.ANTHROPIC_API_KEY});async function l(e,t={},r="openai"){let n=Date.now();try{let a;switch(r){case"openai":a=await u(e,t);break;case"claude":a=await c(e,t);break;default:throw Error(`Unsupported AI provider: ${r}`)}return a.latency=Date.now()-n,a.timestamp=new Date().toISOString(),a}catch(e){throw console.error(`AI generation error (${r}):`,e),e}}async function u(e,t){let r=d(t),n=await o.chat.completions.create({model:i.openai.model,messages:[{role:"system",content:r},{role:"user",content:e}],max_tokens:i.openai.maxTokens,temperature:i.openai.temperature,stream:!1}),a=n.usage?.prompt_tokens||0,s=n.usage?.completion_tokens||0,l=n.usage?.total_tokens||0;return{content:n.choices[0].message.content||"",provider:"openai",model:i.openai.model,tokensUsed:{input:a,output:s,total:l},cost:m(a,s),latency:0,timestamp:""}}async function c(e,t){let r=d(t),n=await s.messages.create({model:i.claude.model,max_tokens:i.claude.maxTokens,temperature:i.claude.temperature,system:r,messages:[{role:"user",content:e}]}),a=n.usage.input_tokens,o=n.usage.output_tokens;return{content:"text"===n.content[0].type?n.content[0].text:"",provider:"claude",model:i.claude.model,tokensUsed:{input:a,output:o,total:a+o},cost:3e-6*a+15e-6*o,latency:0,timestamp:""}}function d(e){let t=`You are an expert AI assistant specialized in automotive dealership optimization and digital marketing. Your primary expertise includes:

1. **AI Visibility Optimization**: Voice search, local SEO, schema markup, and search engine optimization
2. **Revenue Attribution**: Multi-channel marketing attribution, ROI analysis, and performance tracking
3. **Competitive Intelligence**: Market analysis, competitive positioning, and strategic recommendations
4. **Dealership Operations**: Inventory management, customer experience optimization, and process improvement

Your responses should be:
- Actionable and specific to automotive dealerships
- Data-driven with clear metrics and KPIs
- Focused on measurable business outcomes
- Professional yet conversational in tone`;return e.dealerId?`${t}

**Current Dealership Context:**
- Dealer ID: ${e.dealerId}
- Brand: ${e.brand||"Not specified"}
- Location: ${e.location||"Not specified"}
- Current AI Visibility Score: ${e.aiVisibility||"Unknown"}
- Current SEO Score: ${e.seoScore||"Unknown"}
- Monthly Revenue: ${e.monthlyRevenue?`$${e.monthlyRevenue.toLocaleString()}`:"Unknown"}

Provide insights and recommendations based on this specific dealership context.`:t}function m(e,t){return 1e-5*e+3e-5*t}async function p(e,t={},r="openai",n){let a=Date.now();if("openai"===r){let r=d(t),s=await o.chat.completions.create({model:i.openai.model,messages:[{role:"system",content:r},{role:"user",content:e}],max_tokens:i.openai.maxTokens,temperature:i.openai.temperature,stream:!0}),l="",u=0,c=0;for await(let e of s){let t=e.choices[0]?.delta?.content||"";t&&(l+=t,c+=1,n(t)),e.usage&&(u=e.usage.prompt_tokens||0,c=e.usage.completion_tokens||0)}return{content:l,provider:"openai",model:i.openai.model,tokensUsed:{input:u,output:c,total:u+c},cost:m(u,c),latency:Date.now()-a,timestamp:new Date().toISOString()}}return l(e,t,r)}function g(e,t="medium"){return"high"===t?"claude":({"seo-analysis":"openai","competitive-analysis":"claude","content-generation":"claude","data-analysis":"openai","customer-service":"claude","technical-recommendations":"openai"})[e]||"openai"}},59001:(e,t,r)=>{r.d(t,{Lz:()=>m,QO:()=>h,rP:()=>g});var n=r(30596),a=r(81629),i=r(35163),o=r(16573),s=r(53524),l=r(67096),u=r.n(l);let c=(0,r(2381).hu)("auth"),d=new s.PrismaClient,m={adapter:(0,a.N)(d),providers:[(0,o.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,allowDangerousEmailAccountLinking:!0}),(0,i.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return c.warn("Missing credentials in auth attempt"),null;try{let t=await d.user.findUnique({where:{email:e.email},include:{dealer:!0}});if(!t)return c.warn({email:e.email},"User not found"),null;if(!t.isActive)return c.warn({email:e.email},"Inactive user attempted login"),null;if(t.passwordHash&&!await u().compare(e.password,t.passwordHash))return c.warn({email:e.email},"Invalid password"),null;return c.info({userId:t.id,email:t.email,role:t.role,dealerId:t.dealerId},"User authenticated successfully"),{id:t.id,email:t.email,name:t.name,image:t.image,role:t.role,dealerId:t.dealerId,isActive:t.isActive}}catch(t){return c.error({error:t,email:e.email},"Authentication error"),null}}})],session:{strategy:"jwt",maxAge:2592e3},callbacks:{async signIn({user:e,account:t,profile:r}){if(t?.provider==="google")try{let t=await d.user.findUnique({where:{email:e.email}});if(t){if(!t.isActive)return c.warn({email:e.email},"Inactive user attempted Google login"),!1}else{let t=await d.user.create({data:{email:e.email,name:e.name||r?.name||null,image:e.image||r?.picture||null,role:"user",emailVerified:new Date,isActive:!0}});c.info({userId:t.id,email:t.email,provider:"google"},"New Google user created")}}catch(t){return c.error({error:t,email:e.email},"Google sign-in error"),!1}return!0},jwt:async({token:e,user:t,trigger:r,session:n})=>(t&&(e.id=t.id,e.role=t.role,e.dealerId=t.dealerId,e.isActive=t.isActive),"update"===r&&n&&(e.role=n.role||e.role,e.dealerId=n.dealerId||e.dealerId),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.role=t.role,e.user.dealerId=t.dealerId,e.user.isActive=t.isActive),e)},pages:{signIn:"/auth/signin",signUp:"/auth/signup",error:"/auth/error"},events:{signIn:async({user:e,account:t,isNewUser:r})=>{c.info({userId:e.id,email:e.email,provider:t?.provider,isNewUser:r},"User signed in")},signOut:async({token:e})=>{c.info({userId:e?.id,email:e?.email},"User signed out")}},debug:!1,secret:process.env.NEXTAUTH_SECRET};function p(e,t){return e?.user?.role===t}function g(e,t){return!!p(e,"admin")||e?.user?.dealerId===t}function h(e,t={}){return async a=>{try{let{getServerSession:i}=await Promise.all([r.e(4955),r.e(8486)]).then(r.t.bind(r,68486,23)),o=await i(m);if(!o)return n.Z.json({error:"Unauthorized - Please sign in"},{status:401});if(!o.user.isActive)return n.Z.json({error:"Account inactive - Please contact support"},{status:403});if(t.requireRole&&!p(o,t.requireRole))return n.Z.json({error:`Insufficient permissions - ${t.requireRole} role required`},{status:403});if(t.requireDealer&&!o.user.dealerId)return n.Z.json({error:"Dealer access required - Please associate with a dealership"},{status:403});return e(a,o)}catch(e){return c.error({error:e,url:a.url,method:a.method},"Authentication middleware error"),n.Z.json({error:"Authentication service unavailable"},{status:503})}}}},2381:(e,t,r)=>{r.d(t,{hu:()=>i,kg:()=>a});class n{constructor(){this.level=process.env.LOG_LEVEL||"info",this.format=process.env.LOG_FORMAT||"json"}shouldLog(e){let t=["debug","info","warn","error"];return t.indexOf(e)>=t.indexOf(this.level)}formatLog(e){if("json"===this.format)return JSON.stringify({...e,error:e.error?{name:e.error.name,message:e.error.message,stack:e.error.stack}:void 0});let t=`[${e.timestamp}] ${e.level.toUpperCase()}`,r=e.context?` ${JSON.stringify(e.context)}`:"",n=e.error?`
${e.error.stack}`:"";return`${t}: ${e.message}${r}${n}`}log(e,t,r,n){if(!this.shouldLog(e))return;let a={level:e,message:t,timestamp:new Date().toISOString(),context:r,error:n},i=this.formatLog(a);"error"===e?console.error(i):"warn"===e?console.warn(i):console.log(i)}debug(e,t){this.log("debug",e,t)}info(e,t){this.log("info",e,t)}warn(e,t){this.log("warn",e,t)}error(e,t,r){this.log("error",e,r,t)}apiRequest(e,t,r,n){this.info("API Request",{method:e,path:t,status:r,duration_ms:n})}queueJob(e,t,r,n){let a={jobId:e,type:t,...n&&{duration_ms:n}};"failed"===r?this.error(`Queue job ${r}`,void 0,a):this.info(`Queue job ${r}`,a)}costAlert(e,t,r){this.warn("Cost threshold exceeded",{amount:e,threshold:t,period:r,excess:e-t})}}let a=new n;function i(e){let t=new n,r=t.log;return t.log=function(t,n,a,i){let o=`[${e}] ${n}`;return r.call(this,t,o,a,i)},t}}};