"use strict";(()=>{var e={};e.id=925,e.ids=[925],e.modules={53524:e=>{e.exports=require("@prisma/client")},67096:e=>{e.exports=require("bcrypt")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},22885:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>I,originalPathname:()=>V,patchFetch:()=>D,requestAsyncStorage:()=>M,routeModule:()=>x,serverHooks:()=>q,staticGenerationAsyncStorage:()=>C,staticGenerationBailout:()=>P});var n={};r.r(n),r.d(n,{GET:()=>v,POST:()=>y});var i=r(95815),a=r(51150),o=r(10007),s=r(30596),c=r(59001),u=r(89267);async function d(e,t,r="3months"){let n=function(e){let t=e.map(e=>e.revenue||0),r=t.reduce((e,t)=>e+t,0)/t.length,n=function(e){if(e.length<2)return 0;let t=e[0];return Math.pow(e[e.length-1]/t,1/(e.length-1))-1}(t);return{average:r,growth:n,seasonality:f(t),volatility:function(e){let t=e.reduce((e,t)=>e+t,0)/e.length;return Math.sqrt(e.reduce((e,r)=>e+Math.pow(r-t,2),0)/e.length)/t}(t),trend:n>0?"increasing":n<0?"decreasing":"stable"}}(t),i=function(e,t){let r=.7*e.predicted_value+.3*t.predicted_value;return{predicted_value:r,current_value:t.current_value,change_percent:(r-t.current_value)/t.current_value*100,trend:r>t.current_value?"increasing":"decreasing",confidence_interval:[.85*r,1.15*r],key_drivers:[...e.key_drivers||[],...t.key_drivers],recommendations:[...e.recommendations||[],...t.recommendations],risk_factors:[...e.risk_factors||[],...t.risk_factors]}}(await h(e,n,r),function(e,t){let r=e.map(e=>e.revenue||0),n=function(e){let t=e.length,r=Array.from({length:t},(e,t)=>t),n=r.reduce((e,t)=>e+t,0),i=e.reduce((e,t)=>e+t,0),a=(t*r.reduce((t,r,n)=>t+r*e[n],0)-n*i)/(t*r.reduce((e,t)=>e+t*t,0)-n*n),o=(i-a*n)/t;return{slope:a,intercept:o}}(r),i=f(r),a=n.slope*("1month"===t?1:"3months"===t?3:"6months"===t?6:12)+n.intercept+i.adjustment;return{predicted_value:Math.max(0,a),current_value:r[r.length-1]||0,change_percent:(a-(r[r.length-1]||0))/(r[r.length-1]||1)*100,trend:n.slope>0?"increasing":n.slope<0?"decreasing":"stable",confidence_interval:[.9*a,1.1*a],key_drivers:["Historical trend","Seasonal patterns","Market conditions"],recommendations:["Monitor trend continuation","Prepare for seasonal variations"],risk_factors:["Economic uncertainty","Market volatility"]}}(t,r));return{dealerId:e,model:{type:"revenue",timeframe:r,confidence:i.confidence,factors:i.factors},result:i,timestamp:new Date().toISOString(),data_points_used:t.length}}async function l(e,t,r){let n=t.aiVisibility||50,i=r.length?r.reduce((e,t)=>e+(t.aiVisibility||50),0)/r.length-(t.aiVisibility||50):0,a={dealerId:e,currentVisibility:n,competitiveGap:i,marketTrends:await g(e),historicalPerformance:t.trends||[]},o=function(e,t){let r=t*(1+.5*Math.random()-.25);return{predicted_value:Math.max(0,Math.min(100,r)),current_value:t,change_percent:(r-t)/t*100,trend:r>t?"increasing":"decreasing",confidence_interval:[.9*r,1.1*r],key_drivers:["Content optimization","Schema implementation","Local SEO improvements"],recommendations:["Implement structured data","Optimize for voice search","Improve local citations"],risk_factors:["Algorithm changes","Increased competition","Market saturation"]}}((await (0,u.U6)(`Predict AI visibility trends for the next 3 months based on current performance and competitive landscape. Current visibility: ${n}%, competitive gap: ${i}%.`,a,"claude")).content,n);return{dealerId:e,model:{type:"visibility",timeframe:"3months",confidence:o.confidence,factors:["current_seo_score","content_freshness","schema_implementation","local_citations","competitive_gap","search_trends"]},result:o,timestamp:new Date().toISOString(),data_points_used:r.length+(t.trends?.length||0)}}async function m(e,t){let r=function(e){let t=e.reduce((e,t)=>e+(t.purchaseValue||0),0)/e.length,r=e.reduce((e,t)=>e+(t.purchaseFrequency||0),0)/e.length,n=e.reduce((e,t)=>e+(t.lifespanMonths||12),0)/e.length;return{currentCLV:t*r*n,predictedCLV:t*r*n*1.15}}(t);return{dealerId:e,model:{type:"customer_behavior",timeframe:"6months",confidence:.78,factors:["purchase_history","service_interactions","digital_engagement","satisfaction_scores"]},result:{predicted_value:r.predictedCLV,current_value:r.currentCLV,change_percent:(r.predictedCLV-r.currentCLV)/r.currentCLV*100,trend:r.predictedCLV>r.currentCLV?"increasing":"decreasing",confidence_interval:[.85*r.predictedCLV,1.15*r.predictedCLV],key_drivers:["Service satisfaction scores","Purchase frequency patterns","Seasonal buying trends","Loyalty program engagement","Digital touchpoint interactions"],recommendations:["Focus on high-value customer retention programs","Implement personalized marketing campaigns","Optimize service department experience","Enhance digital customer journey"],risk_factors:["Economic downturn impact on luxury purchases","Increased competition from online dealers","Changing consumer preferences toward EVs"]},timestamp:new Date().toISOString(),data_points_used:t.length}}async function p(e,t){var r;let n=function(e,t){let r=t.map(e=>e.overallScore||50),n=r.reduce((e,t)=>e+t,0)/r.length;return{position:n>60?"strong":n>40?"competitive":"challenging",analysis:{strengths:["Local market knowledge","Customer service"],weaknesses:["Digital presence","Online reputation"],opportunities:["Voice search optimization","Mobile experience"],threats:["New market entrants","Digital-first competitors"]}}}(0,t),i={dealerId:e,competitorCount:t.length,marketPosition:n.position,strengthsWeaknesses:n.analysis},a=((await (0,u.U6)(`Analyze competitive threats and opportunities for the next 6 months. Current market position: ${n.position}. Key competitors: ${t.length}.`,i,"claude")).content,{predicted_value:75,current_value:65,change_percent:15.4,trend:"increasing",confidence_interval:[70,80],key_drivers:["Digital transformation","Customer experience enhancement","Market positioning"],recommendations:["Invest in digital marketing","Enhance online presence","Focus on customer retention"],risk_factors:["New market entrants","Economic downturn","Technology disruption"]});return{dealerId:e,model:{type:"competition",timeframe:"6months",confidence:a.confidence,factors:["market_share","pricing_strategy","digital_presence","customer_satisfaction"]},result:a,timestamp:new Date().toISOString(),data_points_used:t.length}}async function h(e,t,r){var n;let i={dealerId:e,currentAverage:t.average,growthRate:t.growth,seasonality:t.seasonality,timeframe:r};return(await (0,u.U6)(`Predict revenue for ${r} based on current performance: average ${t.average}, growth rate ${t.growth}%, seasonality ${t.seasonality}.`,i,"openai")).content,{predicted_value:1.12*t.average,confidence:.82,key_drivers:["Market expansion","Service improvements","Digital optimization"],recommendations:["Focus on high-margin services","Expand digital marketing","Optimize pricing strategy"],risk_factors:["Economic uncertainty","Supply chain disruptions","Increased competition"]}}async function g(e){return{voiceSearchGrowth:.15,localSearchImportance:.85,mobileTrafficShare:.73,competitiveDensity:"high"}}function f(e){return{hasSeasonality:e.length>=12,adjustment:0,pattern:"none"}}let y=(0,c.QO)(async(e,t)=>{try{let r;let{predictionType:n,dealerId:i,timeframe:a="3months",historicalData:o=[]}=await e.json();if(i&&!(0,c.rP)(t,i))return s.Z.json({error:"Access denied - Cannot access dealer analytics"},{status:403});if(!n)return s.Z.json({error:"Prediction type is required"},{status:400});switch(n){case"revenue":r=await d(i,o,a);break;case"visibility":let u=await _(i),h=await k(i);r=await l(i,u,h);break;case"customer_behavior":let g=await w(i);r=await m(i,g);break;case"competition":let f=await k(i);r=await p(i,f);break;default:return s.Z.json({error:"Invalid prediction type"},{status:400})}return await b(t.user.id,i,n,r.result.confidence),s.Z.json({success:!0,prediction:r,generated_at:new Date().toISOString(),user_id:t.user.id})}catch(e){return console.error("Prediction API error:",e),s.Z.json({error:"Failed to generate prediction",details:e.message},{status:500})}}),v=(0,c.QO)(async(e,t)=>{try{let{searchParams:r}=new URL(e.url),n=r.get("dealerId");if(n&&!(0,c.rP)(t,n))return s.Z.json({error:"Access denied"},{status:403});let i=await S(n,t.user.id);return s.Z.json({recent_predictions:i,available_models:[{type:"revenue",description:"Predict monthly revenue based on historical performance and market trends",timeframes:["1month","3months","6months","12months"],confidence_range:"75-90%"},{type:"visibility",description:"Forecast AI visibility improvements based on SEO and competitive analysis",timeframes:["1month","3months","6months"],confidence_range:"70-85%"},{type:"customer_behavior",description:"Predict customer lifetime value and retention patterns",timeframes:["3months","6months","12months"],confidence_range:"65-80%"},{type:"competition",description:"Analyze competitive threats and market positioning changes",timeframes:["3months","6months","12months"],confidence_range:"60-75%"}],usage_stats:{predictions_this_month:i.length,accuracy_rate:"82%",most_requested:"revenue"}})}catch(e){return console.error("Get predictions error:",e),s.Z.json({error:"Failed to fetch predictions"},{status:500})}});async function _(e){try{return{aiVisibility:67,seoScore:74,localRanking:3,monthlyTraffic:12500,conversionRate:.034,trends:[{month:"Jan",score:62},{month:"Feb",score:65},{month:"Mar",score:67},{month:"Apr",score:69},{month:"May",score:67}]}}catch(e){return console.error("Error fetching current metrics:",e),{}}}async function k(e){try{return[{name:"Competitor A",aiVisibility:78,marketShare:.23,overallScore:82,strengths:["Digital presence","Customer reviews"],weaknesses:["Pricing","Inventory selection"]},{name:"Competitor B",aiVisibility:71,marketShare:.18,overallScore:75,strengths:["Location","Brand reputation"],weaknesses:["Digital marketing","Website UX"]},{name:"Competitor C",aiVisibility:84,marketShare:.31,overallScore:88,strengths:["SEO","Content marketing","Social media"],weaknesses:["Customer service","Pricing transparency"]}]}catch(e){return console.error("Error fetching competitor data:",e),[]}}async function w(e){try{return Array.from({length:50},(e,t)=>({customerId:`customer_${t}`,purchaseValue:5e4*Math.random()+15e3,purchaseFrequency:.5*Math.random()+.1,lifespanMonths:60*Math.random()+24,satisfactionScore:2*Math.random()+3,digitalEngagement:Math.random(),serviceInteractions:Math.floor(12*Math.random()),referrals:Math.floor(3*Math.random())}))}catch(e){return console.error("Error fetching customer data:",e),[]}}async function b(e,t,r,n){try{console.log(`Prediction logged: ${r} for ${t} by ${e}, confidence: ${n}`)}catch(e){console.error("Error logging prediction:",e)}}async function S(e,t){try{return[{id:"pred_001",type:"revenue",dealerId:e,predicted_value:892e3,confidence:.85,created_at:new Date(Date.now()-864e5).toISOString()},{id:"pred_002",type:"visibility",dealerId:e,predicted_value:73,confidence:.78,created_at:new Date(Date.now()-2592e5).toISOString()},{id:"pred_003",type:"customer_behavior",dealerId:e,predicted_value:4250,confidence:.71,created_at:new Date(Date.now()-6048e5).toISOString()}]}catch(e){return console.error("Error fetching recent predictions:",e),[]}}let x=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/analytics/predictions/route",pathname:"/api/analytics/predictions",filename:"route",bundlePath:"app/api/analytics/predictions/route"},resolvedPagePath:"/Users/briankramer/Documents/GitHub/dealership-ai/apps/web/app/api/analytics/predictions/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:M,staticGenerationAsyncStorage:C,serverHooks:q,headerHooks:I,staticGenerationBailout:P}=x,V="/api/analytics/predictions/route";function D(){return(0,o.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:C})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[1262,722,1894,9210],()=>r(22885));module.exports=n})();