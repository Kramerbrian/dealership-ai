"use strict";(()=>{var e={};e.id=9008,e.ids=[9008],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},53418:(e,t,n)=>{n.r(t),n.d(t,{headerHooks:()=>y,originalPathname:()=>b,patchFetch:()=>R,requestAsyncStorage:()=>v,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>f});var i={};n.r(i),n.d(i,{GET:()=>p,POST:()=>d});var r=n(95815),a=n(51150),o=n(10007),s=n(30596),c=n(72225);async function u(e){let{searchParams:t}=new URL(e.url),n=t.get("dealerId")||"toyota-naples",i=t.get("timeframe")||"30d",r=t.get("channel")||"all";try{let e={dealerId:n,timeframe:i,channel:r,timestamp:new Date().toISOString(),reportGenerated:new Date().toISOString(),attributionSummary:{totalRevenue:1247e3,aiDrivenRevenue:498800,attributionConfidence:.87,lastUpdated:new Date().toISOString(),trackingPeriod:i,conversionRate:.34},channelAttribution:[{channel:"voice_search",revenue:186400,percentage:.375,customerCount:127,avgTransactionValue:31200,conversionRate:.42,growthRate:.23,touchpoints:{firstTouch:89,assistedConversion:186,lastTouch:74},topQueries:[{query:"Toyota dealership near me",revenue:67200,conversions:23},{query:"new Toyota Camry price",revenue:45800,conversions:18},{query:"Toyota service hours",revenue:23400,conversions:12}]},{channel:"radio_ads",revenue:154300,percentage:.31,customerCount:89,avgTransactionValue:34100,conversionRate:.28,growthRate:.15,touchpoints:{firstTouch:156,assistedConversion:89,lastTouch:67},campaigns:[{campaign:"Spring Sales Event",revenue:89200,conversions:28},{campaign:"Certified Pre-Owned Special",revenue:45100,conversions:19},{campaign:"Service Promotions",revenue:2e4,conversions:8}]},{channel:"lot_optimization",revenue:92800,percentage:.186,customerCount:34,avgTransactionValue:38600,conversionRate:.67,growthRate:.31,touchpoints:{firstTouch:198,assistedConversion:34,lastTouch:156},optimizations:[{change:"Hybrid vehicle front positioning",revenue:34200,conversions:12},{change:"Premium vehicle spacing",revenue:28600,conversions:8},{change:"Improved lot lighting",revenue:18400,conversions:7}]},{channel:"ai_chatbots",revenue:65300,percentage:.131,customerCount:78,avgTransactionValue:28900,conversionRate:.38,growthRate:.45,touchpoints:{firstTouch:234,assistedConversion:167,lastTouch:45},interactions:[{type:"Pricing inquiries",revenue:28700,conversions:23},{type:"Appointment scheduling",revenue:21600,conversions:18},{type:"Service questions",revenue:15e3,conversions:12}]}],customerJourney:{averageTouchpoints:7.3,averageJourneyDuration:"18 days",pathAnalysis:[{path:"Voice Search → Website → Radio Ad → Visit → Sale",frequency:89,conversionRate:.43,averageRevenue:32400,totalRevenue:156800},{path:"Radio Ad → Voice Search → Website → Visit → Sale",frequency:67,conversionRate:.38,averageRevenue:29800,totalRevenue:98600},{path:"Lot Visit → AI Chat → Appointment → Sale",frequency:45,conversionRate:.72,averageRevenue:34900,totalRevenue:87200}],crossChannelSynergy:{voiceSearchRadioCombo:.34,lotOptimizationDigital:.28,aiChatVoiceSearch:.41}},temporalAttribution:{daily:Array.from({length:30},(e,t)=>{let n=new Date;return n.setDate(n.getDate()-(29-t)),{date:n.toISOString().split("T")[0],totalRevenue:Math.floor(15e3*Math.random())+35e3,aiRevenue:Math.floor(8e3*Math.random())+12e3,attributionScore:Math.round((.2*Math.random()+.75)*100)/100}}),hourlyPatterns:{peakHours:[10,11,14,15,18],voiceSearchPeak:[9,10,18,19],radioPeak:[7,8,17,18],lotTrafficPeak:[10,11,14,15,16]}},impactAnalysis:{aiVisibilityCorrelation:.78,incrementalRevenue:{voiceSearchOptimization:234e3,radioOptimization:187e3,lotOptimization:145e3,crossChannelSynergy:98e3},costEfficiency:{voiceSearchROI:8.2,radioROI:5.4,lotOptimizationROI:12.1,aiChatbotROI:6.8},marketShareImpact:{beforeOptimization:.24,afterOptimization:.28,competitorLoss:.04}},predictiveModeling:{next30Days:{projectedRevenue:134e4,aiDrivenProjection:536e3,confidenceInterval:[485e3,587e3],keyDrivers:["Voice search query volume increase","Radio campaign effectiveness","Seasonal buying patterns"]},scenarioAnalysis:[{scenario:"Maintain current AI optimization",projectedAnnualRevenue:158e5,aiContribution:632e4},{scenario:"25% improvement in voice optimization",projectedAnnualRevenue:172e5,aiContribution:774e4},{scenario:"Full multi-channel AI integration",projectedAnnualRevenue:196e5,aiContribution:98e5}]},qualityMetrics:{dataAccuracy:.91,attributionCompleteness:.84,crossDeviceTracking:.76,duplicateElimination:.95,fraudDetection:.98,privacyCompliance:1},insights:[{category:"optimization",priority:"high",insight:"Voice search + radio ad combination shows 34% revenue lift",recommendation:"Coordinate radio campaigns with voice search content",potentialImpact:67e3,confidence:.89},{category:"timing",priority:"medium",insight:"Peak revenue attribution occurs during 10-11 AM and 2-3 PM",recommendation:"Increase AI chatbot staffing during peak hours",potentialImpact:23e3,confidence:.82},{category:"channel",priority:"medium",insight:"Lot optimization has highest conversion rate (67%)",recommendation:"Expand lot optimization investments",potentialImpact:45e3,confidence:.91}]};return s.Z.json(e)}catch(e){return console.error("Revenue Attribution API error:",e),s.Z.json({error:"Failed to fetch revenue attribution data"},{status:500})}}async function l(e){try{let{action:t,parameters:n}=await e.json();switch(t){case"generate_report":return s.Z.json({success:!0,message:"Revenue attribution report generation initiated",reportId:`report-${Date.now()}`,estimatedCompletion:new Date(Date.now()+6e5).toISOString(),includesData:["channel_attribution","customer_journey_analysis","predictive_modeling","roi_calculations"]});case"configure_tracking":return s.Z.json({success:!0,message:"Attribution tracking configuration updated",trackingId:`tracking-${Date.now()}`,newSettings:{attributionWindow:n.attributionWindow||"30 days",channels:n.channels||["all"],conversionTypes:n.conversionTypes||["sale","appointment","lead"]}});case"run_analysis":return s.Z.json({success:!0,message:"Custom attribution analysis started",analysisId:`analysis-${Date.now()}`,analysisType:n.type,estimatedCompletion:new Date(Date.now()+9e5).toISOString(),parameters:{dateRange:n.dateRange,channels:n.channels,metrics:n.metrics}});case"optimize_attribution":return s.Z.json({success:!0,message:"Attribution optimization recommendations generated",optimizationId:`opt-${Date.now()}`,recommendations:[{channel:"voice_search",action:"Increase content frequency",expectedLift:"15-20%",implementation:"immediate"},{channel:"cross_channel",action:"Implement unified customer journey tracking",expectedLift:"25-30%",implementation:"2 weeks"}]});default:return s.Z.json({error:"Unknown revenue attribution action",availableActions:["generate_report","configure_tracking","run_analysis","optimize_attribution"]},{status:400})}}catch(e){return s.Z.json({error:"Failed to process revenue attribution action"},{status:500})}}let p=(0,c.c2)(u),d=(0,c.c2)(l),m=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/enterprise/revenue-attribution/route",pathname:"/api/enterprise/revenue-attribution",filename:"route",bundlePath:"app/api/enterprise/revenue-attribution/route"},resolvedPagePath:"/Users/briankramer/Documents/GitHub/dealership-ai/apps/web/app/api/enterprise/revenue-attribution/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:v,staticGenerationAsyncStorage:h,serverHooks:g,headerHooks:y,staticGenerationBailout:f}=m,b="/api/enterprise/revenue-attribution/route";function R(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},72225:(e,t,n)=>{n.d(t,{c2:()=>o,do:()=>c,vG:()=>u,xq:()=>s});var i=n(30596),r=n(44955);function a(e,t={}){return async n=>{let{roles:a=[],requireDealerId:o=!1,bypassInDevelopment:s=!0}=t;try{let t=await (0,r.getToken)({req:n,secret:process.env.NEXTAUTH_SECRET});if(!t)return i.Z.json({error:"Authentication required"},{status:401});let s={id:t.sub,email:t.email,name:t.name,role:t.role,dealerId:t.dealerId};if(a.length>0&&!a.includes(s.role))return i.Z.json({error:"Insufficient permissions",required:a,current:s.role},{status:403});if(o&&!s.dealerId)return i.Z.json({error:"Dealer association required"},{status:403});return n.user=s,e(n)}catch(e){return console.error("Auth middleware error:",e),i.Z.json({error:"Authentication verification failed"},{status:500})}}}function o(e){return a(e,{roles:["admin"]})}function s(e){return a(e,{roles:["admin","dealer"],requireDealerId:!0})}function c(e,t,n){return"admin"===n||("dealer"===n||"user"===n)&&t===e}function u(e){let{searchParams:t,pathname:n}=new URL(e.url),i=t.get("dealerId");if(i)return i;let r=n.split("/"),a=r.indexOf("dealer");if(-1!==a&&r[a+1])return r[a+1]}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),i=t.X(0,[1262,722,4955],()=>n(53418));module.exports=i})();